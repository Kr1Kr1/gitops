2024-01-28 19:03:22.611 UTC,,,70,,65b6a4fa.46,1,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"ending log output to stderr",,"Future log output will go to log destination ""csvlog"".",,,,,,,"","postmaster",,0
2024-01-28 19:03:22.611 UTC,,,70,,65b6a4fa.46,2,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"starting PostgreSQL 14.7 (Ubuntu 14.7-1.pgdg22.04+1) on aarch64-unknown-linux-gnu, compiled by gcc (Ubuntu 11.3.0-1ubuntu1~22.04) 11.3.0, 64-bit",,,,,,,,,"","postmaster",,0
2024-01-28 19:03:22.611 UTC,,,70,,65b6a4fa.46,3,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"listening on IPv4 address ""0.0.0.0"", port 5432",,,,,,,,,"","postmaster",,0
2024-01-28 19:03:22.611 UTC,,,70,,65b6a4fa.46,4,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"listening on IPv6 address ""::"", port 5432",,,,,,,,,"","postmaster",,0
2024-01-28 19:03:22.623 UTC,,,70,,65b6a4fa.46,5,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"listening on Unix socket ""/var/run/postgresql/.s.PGSQL.5432""",,,,,,,,,"","postmaster",,0
2024-01-28 19:03:22.627 UTC,,,73,,65b6a4fa.49,1,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"database system was shut down at 2024-01-28 19:03:22 UTC",,,,,,,,,"","startup",,0
2024-01-28 19:03:22.633 UTC,,,70,,65b6a4fa.46,6,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"database system is ready to accept connections",,,,,,,,,"","postmaster",,0
2024-01-28 19:03:22.635 UTC,,,84,,65b6a4fa.54,1,,2024-01-28 19:03:22 UTC,4/0,0,LOG,00000,"TimescaleDB background worker launcher connected to shared catalogs",,,,,,,,,"","TimescaleDB Background Worker Launcher",,0
2024-01-28 19:03:22.649 UTC,,,83,,65b6a4fa.53,1,,2024-01-28 19:03:22 UTC,2/0,0,LOG,00000,"pg_cron scheduler started",,,,,,,,,"","pg_cron launcher",,0
2024-01-28 19:03:23.602 UTC,,,88,"[local]",65b6a4fb.58,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.603 UTC,"postgres","postgres",88,"[local]",65b6a4fb.58,2,"authentication",2024-01-28 19:03:23 UTC,5/4,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=pg_isready",,,,,,,,,"","client backend",,0
2024-01-28 19:03:23.606 UTC,"postgres","postgres",88,"[local]",65b6a4fb.58,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.003 user=postgres database=postgres host=[local]",,,,,,,,,"pg_isready","client backend",,0
2024-01-28 19:03:23.608 UTC,,,90,"[local]",65b6a4fb.5a,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.609 UTC,"postgres","postgres",90,"[local]",65b6a4fb.5a,2,"authentication",2024-01-28 19:03:23 UTC,5/5,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=pg_isready",,,,,,,,,"","client backend",,0
2024-01-28 19:03:23.610 UTC,"postgres","postgres",90,"[local]",65b6a4fb.5a,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.002 user=postgres database=postgres host=[local]",,,,,,,,,"pg_isready","client backend",,0
2024-01-28 19:03:23.614 UTC,,,91,"[local]",65b6a4fb.5b,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.614 UTC,"postgres","postgres",91,"[local]",65b6a4fb.5b,2,"authentication",2024-01-28 19:03:23 UTC,5/6,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=Patroni",,,,,,,,,"","client backend",,0
2024-01-28 19:03:23.703 UTC,,,96,"[local]",65b6a4fb.60,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.703 UTC,"postgres","postgres",96,"[local]",65b6a4fb.60,2,"authentication",2024-01-28 19:03:23 UTC,6/1,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=psql",,,,,,,,,"","client backend",,0
2024-01-28 19:03:23.707 UTC,"postgres","postgres",96,"[local]",65b6a4fb.60,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.722 UTC,,,103,"[local]",65b6a4fb.67,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.723 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,2,"authentication",2024-01-28 19:03:23 UTC,6/3,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=psql",,,,,,,,,"","client backend",,-8916428659736130509
2024-01-28 19:03:23.723 UTC,,,104,"[local]",65b6a4fb.68,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.724 UTC,"postgres","postgres",104,"[local]",65b6a4fb.68,2,"authentication",2024-01-28 19:03:23 UTC,7/1,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=psql",,,,,,,,,"","client backend",,0
2024-01-28 19:03:23.727 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,3,"idle",2024-01-28 19:03:23 UTC,6/5,0,LOG,00000,"statement: GRANT cron_admin TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.729 UTC,"postgres","postgres",104,"[local]",65b6a4fb.68,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.731 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,4,"idle",2024-01-28 19:03:23 UTC,6/8,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS pg_auth_mon SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.744 UTC,,,109,"[local]",65b6a4fb.6d,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.745 UTC,"postgres","postgres",109,"[local]",65b6a4fb.6d,2,"authentication",2024-01-28 19:03:23 UTC,7/3,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=psql",,,,,,,,,"","client backend",,814700484072941690
2024-01-28 19:03:23.750 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,5,"idle",2024-01-28 19:03:23 UTC,6/9,0,LOG,00000,"statement: ALTER EXTENSION pg_auth_mon UPDATE;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.750 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,6,"idle",2024-01-28 19:03:23 UTC,6/10,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.pg_auth_mon TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.752 UTC,"postgres","postgres",109,"[local]",65b6a4fb.6d,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.007 user=postgres database=postgres host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.752 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,7,"idle",2024-01-28 19:03:23 UTC,6/11,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS pg_cron SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.768 UTC,,,114,"[local]",65b6a4fb.72,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.768 UTC,"postgres","postgres",114,"[local]",65b6a4fb.72,2,"authentication",2024-01-28 19:03:23 UTC,7/6,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=psql",,,,,,,,,"","client backend",,700856508230840190
2024-01-28 19:03:23.772 UTC,"postgres","postgres",114,"[local]",65b6a4fb.72,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.777 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,8,"idle",2024-01-28 19:03:23 UTC,6/13,0,LOG,00000,"statement: ALTER EXTENSION pg_cron UPDATE;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.777 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,9,"idle",2024-01-28 19:03:23 UTC,6/14,0,LOG,00000,"statement: ALTER POLICY cron_job_policy ON cron.job USING (username = current_user OR
    (pg_has_role(current_user, 'cron_admin', 'MEMBER')
    AND pg_has_role(username, 'cron_admin', 'MEMBER')
    AND NOT EXISTS(SELECT 1 FROM pg_roles WHERE rolname = username AND rolsuper)
    ));",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.777 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,10,"idle",2024-01-28 19:03:23 UTC,6/15,0,LOG,00000,"statement: REVOKE SELECT ON cron.job FROM admin, public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.778 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,11,"idle",2024-01-28 19:03:23 UTC,6/16,0,LOG,00000,"statement: GRANT SELECT ON cron.job TO cron_admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.778 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,12,"idle",2024-01-28 19:03:23 UTC,6/17,0,LOG,00000,"statement: REVOKE UPDATE (database, nodename) ON cron.job FROM admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.778 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,13,"idle",2024-01-28 19:03:23 UTC,6/18,0,LOG,00000,"statement: GRANT UPDATE (database, nodename) ON cron.job TO cron_admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.778 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,14,"idle",2024-01-28 19:03:23 UTC,6/19,0,LOG,00000,"statement: ALTER POLICY cron_job_run_details_policy ON cron.job_run_details USING (username = current_user OR
    (pg_has_role(current_user, 'cron_admin', 'MEMBER')
    AND pg_has_role(username, 'cron_admin', 'MEMBER')
    AND NOT EXISTS(SELECT 1 FROM pg_roles WHERE rolname = username AND rolsuper)
    ));",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.778 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,15,"idle",2024-01-28 19:03:23 UTC,6/20,0,LOG,00000,"statement: REVOKE SELECT ON cron.job_run_details FROM admin, public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.779 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,16,"idle",2024-01-28 19:03:23 UTC,6/21,0,LOG,00000,"statement: GRANT SELECT ON cron.job_run_details TO cron_admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.779 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,17,"idle",2024-01-28 19:03:23 UTC,6/22,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION cron.schedule_in_database(p_schedule text, p_database text, p_command text)
RETURNS bigint
LANGUAGE plpgsql
AS $function$
DECLARE
    l_jobid bigint;
BEGIN
    IF NOT (SELECT rolcanlogin FROM pg_roles WHERE rolname = current_user)
    THEN RAISE 'You cannot create a job using a role that cannot log in';
    END IF;

    SELECT schedule INTO l_jobid FROM cron.schedule(p_schedule, p_command);
    UPDATE cron.job SET database = p_database, nodename = '' WHERE jobid = l_jobid;
    RETURN l_jobid;
END;
$function$;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.779 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,18,"idle",2024-01-28 19:03:23 UTC,6/23,0,LOG,00000,"statement: REVOKE EXECUTE ON ALL FUNCTIONS IN SCHEMA cron FROM admin, public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.780 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,19,"idle",2024-01-28 19:03:23 UTC,6/24,0,LOG,00000,"statement: GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA cron TO cron_admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.781 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,20,"idle",2024-01-28 19:03:23 UTC,6/25,0,LOG,00000,"statement: REVOKE USAGE ON SCHEMA cron FROM admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.781 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,21,"idle",2024-01-28 19:03:23 UTC,6/26,0,LOG,00000,"statement: GRANT USAGE ON SCHEMA cron TO cron_admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.781 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,22,"idle",2024-01-28 19:03:23 UTC,6/27,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS file_fdw SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.785 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,23,"idle",2024-01-28 19:03:23 UTC,6/29,0,LOG,00000,"statement: CREATE TABLE IF NOT EXISTS public.postgres_log (
    log_time timestamp(3) with time zone,
    user_name text,
    database_name text,
    process_id integer,
    connection_from text,
    session_id text NOT NULL,
    session_line_num bigint NOT NULL,
    command_tag text,
    session_start_time timestamp with time zone,
    virtual_transaction_id text,
    transaction_id bigint,
    error_severity text,
    sql_state_code text,
    message text,
    detail text,
    hint text,
    internal_query text,
    internal_query_pos integer,
    context text,
    query text,
    query_pos integer,
    location text,
    application_name text,
    CONSTRAINT postgres_log_check CHECK (false) NO INHERIT
);",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.787 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,24,"idle",2024-01-28 19:03:23 UTC,6/30,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.787 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,25,"idle",2024-01-28 19:03:23 UTC,6/31,0,LOG,00000,"statement: ALTER TABLE public.postgres_log ADD COLUMN IF NOT EXISTS backend_type text;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.787 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,26,"idle",2024-01-28 19:03:23 UTC,6/32,0,LOG,00000,"statement: ALTER TABLE public.postgres_log ADD COLUMN IF NOT EXISTS leader_pid integer;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.788 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,27,"idle",2024-01-28 19:03:23 UTC,6/33,0,LOG,00000,"statement: ALTER TABLE public.postgres_log ADD COLUMN IF NOT EXISTS query_id bigint;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.788 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,28,"idle",2024-01-28 19:03:23 UTC,6/34,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_0 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-0.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.788 UTC,,,119,"[local]",65b6a4fb.77,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.789 UTC,"postgres","postgres",119,"[local]",65b6a4fb.77,2,"authentication",2024-01-28 19:03:23 UTC,7/9,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=psql",,,,,,,,,"","client backend",,700856508230840190
2024-01-28 19:03:23.790 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,29,"idle",2024-01-28 19:03:23 UTC,6/35,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_0 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.790 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,30,"idle",2024-01-28 19:03:23 UTC,6/36,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_0 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_0
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.791 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,31,"idle",2024-01-28 19:03:23 UTC,6/37,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_0 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.792 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,32,"idle",2024-01-28 19:03:23 UTC,6/38,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_0 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.792 UTC,"postgres","postgres",119,"[local]",65b6a4fb.77,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.003 user=postgres database=postgres host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.793 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,33,"idle",2024-01-28 19:03:23 UTC,6/39,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_1 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-1.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.794 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,34,"idle",2024-01-28 19:03:23 UTC,6/40,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_1 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.794 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,35,"idle",2024-01-28 19:03:23 UTC,6/41,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_1 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_1
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.796 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,36,"idle",2024-01-28 19:03:23 UTC,6/42,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_1 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.796 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,37,"idle",2024-01-28 19:03:23 UTC,6/43,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_1 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.796 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,38,"idle",2024-01-28 19:03:23 UTC,6/44,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_2 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-2.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.797 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,39,"idle",2024-01-28 19:03:23 UTC,6/45,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_2 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.797 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,40,"idle",2024-01-28 19:03:23 UTC,6/46,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_2 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_2
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.798 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,41,"idle",2024-01-28 19:03:23 UTC,6/47,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_2 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.798 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,42,"idle",2024-01-28 19:03:23 UTC,6/48,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_2 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.799 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,43,"idle",2024-01-28 19:03:23 UTC,6/49,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_3 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-3.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.800 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,44,"idle",2024-01-28 19:03:23 UTC,6/50,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_3 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.800 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,45,"idle",2024-01-28 19:03:23 UTC,6/51,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_3 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_3
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.801 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,46,"idle",2024-01-28 19:03:23 UTC,6/52,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_3 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.802 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,47,"idle",2024-01-28 19:03:23 UTC,6/53,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_3 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.802 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,48,"idle",2024-01-28 19:03:23 UTC,6/54,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_4 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-4.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.803 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,49,"idle",2024-01-28 19:03:23 UTC,6/55,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_4 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.803 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,50,"idle",2024-01-28 19:03:23 UTC,6/56,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_4 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_4
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.805 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,51,"idle",2024-01-28 19:03:23 UTC,6/57,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_4 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.805 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,52,"idle",2024-01-28 19:03:23 UTC,6/58,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_4 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.805 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,53,"idle",2024-01-28 19:03:23 UTC,6/59,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_5 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-5.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.805 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,54,"idle",2024-01-28 19:03:23 UTC,6/60,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_5 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.806 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,55,"idle",2024-01-28 19:03:23 UTC,6/61,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_5 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_5
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.807 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,56,"idle",2024-01-28 19:03:23 UTC,6/62,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_5 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.807 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,57,"idle",2024-01-28 19:03:23 UTC,6/63,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_5 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.807 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,58,"idle",2024-01-28 19:03:23 UTC,6/64,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_6 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-6.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.808 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,59,"idle",2024-01-28 19:03:23 UTC,6/65,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_6 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.808 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,60,"idle",2024-01-28 19:03:23 UTC,6/66,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_6 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_6
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.809 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,61,"idle",2024-01-28 19:03:23 UTC,6/67,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_6 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.809 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,62,"idle",2024-01-28 19:03:23 UTC,6/68,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_6 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.809 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,63,"idle",2024-01-28 19:03:23 UTC,6/69,0,LOG,00000,"statement: CREATE FOREIGN TABLE IF NOT EXISTS public.postgres_log_7 () INHERITS (public.postgres_log) SERVER pglog
    OPTIONS (filename '../pg_log/postgresql-7.csv', format 'csv', header 'false');",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.810 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,64,"idle",2024-01-28 19:03:23 UTC,6/70,0,LOG,00000,"statement: GRANT SELECT ON public.postgres_log_7 TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.810 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,65,"idle",2024-01-28 19:03:23 UTC,6/71,0,LOG,00000,"statement: CREATE OR REPLACE VIEW public.failed_authentication_7 WITH (security_barrier) AS
SELECT *
  FROM public.postgres_log_7
 WHERE command_tag = 'authentication'
   AND error_severity = 'FATAL';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.810 UTC,,,126,"[local]",65b6a4fb.7e,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.811 UTC,"postgres","template1",126,"[local]",65b6a4fb.7e,2,"authentication",2024-01-28 19:03:23 UTC,7/11,0,LOG,00000,"connection authorized: user=postgres database=template1 application_name=psql",,,,,,,,,"","client backend",,-471367678348975900
2024-01-28 19:03:23.811 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,66,"idle",2024-01-28 19:03:23 UTC,6/72,0,LOG,00000,"statement: ALTER VIEW public.failed_authentication_7 OWNER TO postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.812 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,67,"idle",2024-01-28 19:03:23 UTC,6/73,0,LOG,00000,"statement: GRANT SELECT ON TABLE public.failed_authentication_7 TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.812 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,68,"idle",2024-01-28 19:03:23 UTC,6/76,0,LOG,00000,"statement: DROP SCHEMA IF EXISTS zmon_utils CASCADE;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.819 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,69,"idle",2024-01-28 19:03:23 UTC,6/78,0,LOG,00000,"statement: DROP LANGUAGE IF EXISTS plpythonu;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.819 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,70,"idle",2024-01-28 19:03:23 UTC,6/79,0,LOG,00000,"statement: DROP FUNCTION IF EXISTS plpython_call_handler();",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.819 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,71,"idle",2024-01-28 19:03:23 UTC,6/80,0,LOG,00000,"statement: DROP FUNCTION IF EXISTS plpython_inline_handler(internal);",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.819 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,72,"idle",2024-01-28 19:03:23 UTC,6/81,0,LOG,00000,"statement: DROP FUNCTION IF EXISTS plpython_validator(oid);",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.819 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,73,"idle",2024-01-28 19:03:23 UTC,6/82,0,LOG,00000,"statement: CREATE SCHEMA zmon_utils;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.820 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,74,"idle",2024-01-28 19:03:23 UTC,6/83,0,LOG,00000,"statement: GRANT USAGE ON SCHEMA zmon_utils TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.820 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,75,"idle",2024-01-28 19:03:23 UTC,6/85,0,LOG,00000,"statement: CREATE TYPE zmon_utils.system_information AS (
    parameter TEXT,
    setting TEXT
);",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.821 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,76,"idle",2024-01-28 19:03:23 UTC,6/86,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION zmon_utils.get_database_cluster_information()
RETURNS TABLE ( parameter text, setting text )
AS $BODY$
DECLARE
   wal_segment          BIGINT;
   wal_offset           BIGINT;
   wal_multiplier       BIGINT;
   wal_delay_seconds    BIGINT;
   in_recovery          BOOLEAN;
   xlog_location_string TEXT;
   receive_location     TEXT;
   server_version_num   INTEGER;
   nosync               INTEGER;
BEGIN
  server_version_num := current_setting('server_version_num')::integer;
  SELECT pg_is_in_recovery() INTO in_recovery;
  IF server_version_num >= 100000
  THEN
    SELECT CASE WHEN in_recovery THEN pg_last_wal_replay_lsn()
           ELSE pg_current_wal_lsn()
           END INTO xlog_location_string;
    SELECT pg_last_wal_receive_lsn() INTO receive_location;
  ELSE
    SELECT CASE WHEN in_recovery THEN pg_last_xlog_replay_location()
           ELSE pg_current_xlog_location()
           END INTO xlog_location_string;
    SELECT pg_last_xlog_receive_location() INTO receive_location;
  END IF;
  SELECT ('x'||lpad(split_part(xlog_location_string, '/', 1), 16, '0'))::bit(64)::bigint INTO wal_segment;
  SELECT ('x'||lpad(split_part(xlog_location_string, '/', 2), 16, '0'))::bit(64)::bigint INTO wal_offset;
  SELECT 1 FROM pg_ls_dir('.') as t(name) WHERE name = 'dontsync' INTO nosync;
  IF server_version_num >= 90300
  THEN
    wal_multiplier = CAST(x'FFFFFFFF' as bigint);
  ELSE
    wal_multiplier = CAST(x'FF000000' as bigint);
  END IF;

  IF server_version_num >= 90100 AND in_recovery
  THEN
    wal_delay_seconds := extract(epoch from now() - pg_last_xact_replay_timestamp())::bigint;
  END IF;

  RETURN QUERY
  SELECT 'zmon_utils_version', '11'
   UNION ALL
  SELECT 'server_version_num', server_version_num::text
   UNION ALL
  SELECT s.name, s.setting
    FROM pg_settings as s
   WHERE name in ('archive_mode',
                  'archive_command',
                  'archive_timeout',
                  'checkpoint_segments',
                  'listen_address',      -- connection
                  'port',                -- connection
                  'ssl',                 -- connection
                  'max_connections',     -- connection
                  'data_directory',      -- disk
                  'fsync',               -- disk
                  'full_page_writes',
                  'hba_file',
                  'ident_file',
                  'hot_standby',
                  'log_destination',
                  'log_directory',
                  'log_filename',
                  'shared_buffers',
                  'synchronous_commit'
                 )
   UNION ALL
  SELECT 'cluster_name', COALESCE(CASE WHEN server_version_num >= 90500 THEN current_setting('cluster_name') ELSE NULL END, substring(s.setting from E'/pgsql_([^/]+)/[^/]+/data$'))
    FROM pg_settings as s
   WHERE s.name = 'data_directory'
   UNION ALL
  SELECT 'defined_databases', string_agg(quote_ident(datname), E'\n')
    FROM pg_database
   WHERE datname != 'postgres'
     AND NOT datistemplate
     AND datallowconn
   UNION ALL
  SELECT 'is_in_recovery' as name, in_recovery::text as setting
    UNION ALL
  SELECT 'wal_bytes_from_zero' as name, CAST(wal_segment::numeric * wal_multiplier + wal_offset AS TEXT) as setting
    UNION ALL
  SELECT 'wal_delay_seconds' as name, wal_delay_seconds::text
    UNION ALL
  SELECT 'is_streaming' as name, CAST(receive_location IS NOT NULL AND in_recovery AS TEXT) as setting
    UNION ALL
  SELECT 'archive_nosync' as name, CAST(nosync IS NOT NULL AS TEXT) as setting;
  -- pg_stat_activity column names differ depending on server version
  IF server_version_num >= 90600 THEN
    RETURN QUERY
    SELECT a.name, a.setting
      FROM unnest((select array[('active_connections'::text,
                                 count(CASE WHEN state = 'active' THEN 1 END)::text),
                                ('idle_in_transaction_connections'::text,
                                 count(CASE WHEN state = 'idle in transaction' THEN 1 END)::text),
                                ('idle_in_transaction_max_age'::text,
                                 coalesce(max(CASE WHEN state = 'idle in transaction' THEN extract(epoch from statement_timestamp() - state_change) END), 0)::text),
                                ('locked_connections'::text,
                                 count(CASE WHEN wait_event_type = 'Lock' THEN 1 END)::text),
                                ('current_connections'::text,
                                 count(1)::text),
                                ('transaction_max_age'::text,
                                 -- exclude autovacuum transactions
                                 coalesce(extract(epoch from statement_timestamp() - min(CASE WHEN query like 'autovacuum:%' THEN NULL ELSE xact_start END)),0)::text)
                               ]
                     from pg_stat_activity
                 )) AS a (name text, setting text);
  ELSE
    RETURN QUERY
    SELECT a.name, a.setting
      FROM unnest((select array[('active_connections'::text,
                                 count(CASE WHEN state = 'active' THEN 1 END)::text),
                                ('idle_in_transaction_connections'::text,
                                 count(CASE WHEN state = 'idle in transaction' THEN 1 END)::text),
                                ('idle_in_transaction_max_age'::text,
                                 coalesce(max(CASE WHEN state = 'idle in transaction' THEN extract(epoch from statement_timestamp() - state_change) END), 0)::text),
                                ('locked_connections'::text,
                                 count(CASE WHEN waiting THEN 1 END)::text),
                                ('current_connections'::text,
                                 count(1)::text),
                                ('transaction_max_age'::text,
                                 -- exclude autovacuum transactions
                                 coalesce(extract(epoch from statement_timestamp() - min(CASE WHEN query like 'autovacuum:%' THEN NULL ELSE xact_start END)),0)::text)
                               ]
                     from pg_stat_activity
                 )) AS a (name text, setting text);
  END IF;
END
$BODY$
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.825 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,77,"idle",2024-01-28 19:03:23 UTC,6/87,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION zmon_utils.get_database_cluster_system_information()
RETURNS SETOF zmon_utils.system_information
AS
$BODY$
""""""
NOTE: this is python 2.5 compatible code

This function returns the system related data of the database cluster related disks.
It can be slow, so do not call it too often

load.1
load.5
load.15
cpu.count

xlog.location
xlog.size
xlog.device.name
xlog.device.total
xlog.device.used
xlog.devide.free

tablespace.<tablespacename>.size
tablespace.<tablespacename>.device
# for example
tablespace.pg_default.size
tablespace.pg_default.location
tablespace.pg_default.device

memory.commmit.diff

platform.release
platform.version
platform.kernel

vm.overcommit_memory
vm.overcommit_ratio

""""""
import os
import platform


def get_mount_point(pathname):
    ""Get the mount point of the filesystem containing pathname""
    pathname = os.path.normcase(os.path.realpath(pathname))
    parent_device = path_device = os.stat(pathname).st_dev
    while parent_device == path_device:
        mount_point = pathname
        pathname = os.path.dirname(pathname)
        if pathname == mount_point:
            break
        parent_device = os.stat(pathname).st_dev
    return mount_point


def get_mounted_device(pathname):
    ""Get the device mounted at pathname""
    # uses ""/proc/mounts""
    pathname = os.path.normcase(pathname)  # might be unnecessary here
    try:
        ifp = open(""/proc/mounts"", ""r"")
        try:
            for line in ifp:
                fields = line.rstrip('\n').split()
                # note that line above assumes that
                # no mount points contain whitespace
                if fields[1] == pathname:
                    return fields[0]
        finally:
            ifp.close()
    except EnvironmentError:
        pass
    return None  # explicit


def get_fs_space(pathname):
    ""Get the free space of the filesystem containing pathname""
    stat = os.statvfs(pathname)
    # use f_bfree for superuser, or f_bavail if filesystem
    # has reserved space for superuser
    total = stat.f_blocks * stat.f_bsize
    free = stat.f_bavail * stat.f_bsize
    return total, free,


def get_dir_size(pathname):
    """""" Get the total size of the directory in bytes.
        Ignore files located on different partitions.
    """"""
    size = 0
    folders = [pathname]
    root_dev = os.lstat(pathname).st_dev
    while len(folders):
        c = folders.pop()
        for e in os.listdir(c):
            e = os.path.join(c, e)
            try:
                st = os.lstat(e)
                # skip data on different partition
                if st.st_dev != root_dev:
                    continue
                mode = st.st_mode & 0xf000  # S_IFMT
                if mode == 0x4000:  # S_IFDIR
                    folders.append(e)
                    size += st.st_size
                if mode == 0x8000:  # S_IFREG
                    size += st.st_size
            except:
                # probably the file was removed already, so just skip it
                pass
    return size


def collect_tablespaces_stats(data_directory):
    """""" fetch tablespaces names and oid - the latter is necessary
        to get the sizes information from the file system
    """"""
    result = {}
    ts = {}
    stats = {}
    if ""stmt_tablespaces"" in SD:
        plan = SD['stmt_tablespaces']
    else:
        plan = plpy.prepare(""SELECT oid, spcname FROM pg_catalog.pg_tablespace"")
        SD['stmt_tablespaces'] = plan

    rv = plpy.execute(plan)
    for r in rv:
        ts[r[""oid""]] = r[""spcname""]
    # get to the filesystem and fetch sizes and devices
    ts_root = os.path.join(data_directory, 'pg_tblspc')
    for oid in ts:
        # special cases - pg_global and pg_default. We are not interested in pg_global,
        # and will treat pg_default simply as datadir
        if ts[oid] == 'pg_default':
            stats = collect_directory_stats(data_directory, ""tablespace.%s"" % ts[oid])
        elif ts[oid] != 'pg_global':
            stats = collect_directory_stats(os.path.join(ts_root, oid), ""tablespace.%s"" % ts[oid])
        result.update(stats)
    return result


def get_platform_information():
    result = {}
    result['platform.version'] = platform.version()
    result['platform.release'] = platform.release()
    result['platform.kernel']  = (platform.release() or '').split('-')[0]

    return result


def collect_directory_stats(path, prefix):
    """""" Collect real location, size, mount device, total and free space on a device for a dir """"""
    stat = {}
    location = os.path.realpath(path)
    stat[prefix+'.location'] = location
    mount_point = get_mount_point(location)
    # do we really need roots here?
    stat[prefix+'.device'] = get_mounted_device(mount_point)
    stat[prefix+'.total'], stat[prefix+'.free'] = get_fs_space(mount_point)
    # might be slow due to traversal of subdirectories
    stat[prefix+'.size'] = get_dir_size(location)
    return stat


def get_load_average():
    return dict(zip(('load.1', 'load.5', 'load.15'), os.getloadavg()))


def get_number_of_cpus():
    try:
        number_of_cpus = open('/proc/cpuinfo').read().count('processor\t:')
        if number_of_cpus > 0:
            return {'cpu.count': number_of_cpus}
    except IOError:
        # on other system, basically on Solaris, this file doesn't exist
        pass


def get_memory_info():
    ""Get the memory info""
    # information is obtained from /proc/meminfo
    mem_info = {}
    expected_keys = { 'MemTotal':    'memory.total',
                      'MemFree':     'memory.free',
                      'Buffers':     'memory.buffers',
                      'Cached':      'memory.cached',
                      'SwapTotal':   'memory.swap.total',
                      'SwapFree':    'memory.swap.free',
                      'Dirty':       'memory.dirty',
                      'CommitLimit': 'memory.commit.limit',
                      'Committed_AS':'memory.commit.as',
                    }
    expected_key_count = len(expected_keys)
    try:
        ifp = open(""/proc/meminfo"", ""r"")
        try:
            for line in ifp:
                meminfo_key, value, = line.rstrip('\n').split(':')
                key = expected_keys.get(meminfo_key)
                if key:
                    mem_info[key] = int(value.strip(' kB')) * 1024 # we use bytes everywhere
                    if len(mem_info) == expected_key_count:
                        break
        finally:
            ifp.close()
    except EnvironmentError:
        return None
    commit_limit = mem_info['memory.commit.limit']
    committed_as = mem_info['memory.commit.as']
    if commit_limit and committed_as:
        mem_info['memory.commit.diff'] = commit_limit - committed_as
    return mem_info

def get_vm_info():
    ""get information about virtual memory configuration, specifically overcommit settings""
    vm_info = {}
    file_keys = { '/proc/sys/vm/overcommit_memory': 'vm.overcommit_memory',
                  '/proc/sys/vm/overcommit_ratio' : 'vm.overcommit_ratio'
                }
    try:
        for fname, kname in file_keys.items():
            try:
                fp = open(fname, 'r')
                val = int(fp.read().strip())
                vm_info[kname] = val
            finally:
                fp.close()
    except EnvironmentError:
        pass
    return vm_info

if ""stmt_settings"" in SD:
    plan = SD[""stmt_settings""]
else:
    plan = plpy.prepare(""SELECT name, setting FROM pg_catalog.pg_settings WHERE name in ('data_directory', 'log_directory', 'server_version_num')"")
    SD[""stmt_settings""] = plan

rv = plpy.execute(plan)
s = {}
for r in rv:
    s[r[""name""]] = r[""setting""]

data_directory = s[""data_directory""]
log_directory = s[""log_directory""] = os.path.join(data_directory, s[""log_directory""])
pg_tblspc = os.path.join(data_directory, ""pg_tblspc"")
pg_xlog = os.path.join(data_directory, ""pg_xlog"" if int(s[""server_version_num""]) < 100000 else ""pg_wal"")

result = {}

# get tablespaces (including pg_default)
ts_stats = collect_tablespaces_stats(data_directory)
if len(ts_stats) > 0:
    result.update(ts_stats)

#get xlog and log directories
for (path, prefix) in ((pg_xlog, 'xlog'), (log_directory, 'log')):
    if os.path.isdir(path):
        stats = collect_directory_stats(path, prefix)
        if len(stats) > 0:
            result.update(stats)

result.update(get_platform_information())
result.update(get_load_average())
result.update(get_number_of_cpus())
mem_info = get_memory_info()
if mem_info:
    result.update(mem_info)
vm_info = get_vm_info()
if vm_info:
    result.update(vm_info)

return result.items()

$BODY$
LANGUAGE plpython3u
SECURITY DEFINER
SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.826 UTC,"postgres","template1",126,"[local]",65b6a4fb.7e,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.015 user=postgres database=template1 host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.841 UTC,,,131,"[local]",65b6a4fb.83,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.842 UTC,"postgres","template1",131,"[local]",65b6a4fb.83,2,"authentication",2024-01-28 19:03:23 UTC,7/14,0,LOG,00000,"connection authorized: user=postgres database=template1 application_name=psql",,,,,,,,,"","client backend",,700856508230840190
2024-01-28 19:03:23.845 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,78,"idle",2024-01-28 19:03:23 UTC,6/88,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION zmon_utils.get_last_status_active_cronjobs(
  OUT jobid bigint,
  OUT database text,
  OUT command text,
  OUT status text,
  OUT return_message text,
  OUT start_time timestamp with time zone,
  OUT end_time timestamp with time zone
  ) RETURNS SETOF record AS
$BODY$
SELECT DISTINCT ON (job_run_details.jobid)
       job_run_details.jobid,
       job_run_details.database,
       job_run_details.command,
       job_run_details.status,
       job_run_details.return_message,
       job_run_details.start_time,
       job_run_details.end_time
  FROM job
  JOIN job_run_details USING (jobid)
 WHERE job.active
 ORDER BY job_run_details.jobid, job_run_details.start_time DESC NULLS LAST;
$BODY$
LANGUAGE sql SECURITY DEFINER STRICT SET search_path to 'cron';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.846 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,79,"idle",2024-01-28 19:03:23 UTC,6/89,0,LOG,00000,"statement: REVOKE EXECUTE ON FUNCTION zmon_utils.get_last_status_active_cronjobs() FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.846 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,80,"idle",2024-01-28 19:03:23 UTC,6/90,0,LOG,00000,"statement: CREATE OR REPLACE VIEW zmon_utils.last_status_active_cronjobs AS SELECT * FROM zmon_utils.get_last_status_active_cronjobs();",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.846 UTC,"postgres","template1",131,"[local]",65b6a4fb.83,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=template1 host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.847 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,81,"idle",2024-01-28 19:03:23 UTC,6/91,0,LOG,00000,"statement: REVOKE ALL ON TABLE zmon_utils.last_status_active_cronjobs FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.847 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,82,"idle",2024-01-28 19:03:23 UTC,6/92,0,LOG,00000,"statement: GRANT SELECT ON TABLE zmon_utils.last_status_active_cronjobs TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.848 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,83,"idle",2024-01-28 19:03:23 UTC,6/93,0,LOG,00000,"statement: GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA zmon_utils TO robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.849 UTC,,,136,"[local]",65b6a4fb.88,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.850 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,2,"authentication",2024-01-28 19:03:23 UTC,7/17,0,LOG,00000,"connection authorized: user=postgres database=postgres application_name=psql",,,,,,,,,"","client backend",,700856508230840190
2024-01-28 19:03:23.850 UTC,"postgres","postgres",103,"[local]",65b6a4fb.67,84,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.128 user=postgres database=postgres host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.850 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,3,"idle",2024-01-28 19:03:23 UTC,7/18,0,LOG,00000,"statement: CREATE SCHEMA IF NOT EXISTS user_management;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.851 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,4,"idle",2024-01-28 19:03:23 UTC,7/19,0,LOG,00000,"statement: GRANT USAGE ON SCHEMA user_management TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.852 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,5,"idle",2024-01-28 19:03:23 UTC,7/21,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION random_password (length integer) RETURNS text LANGUAGE sql AS
$$
WITH chars (c) AS (
    SELECT chr(33)
    UNION ALL
    SELECT chr(i) FROM generate_series (35, 38) AS t (i)
    UNION ALL
    SELECT chr(i) FROM generate_series (42, 90) AS t (i)
    UNION ALL
    SELECT chr(i) FROM generate_series (97, 122) AS t (i)
),
bricks (b) AS (
    -- build a pool of chars (the size will be the number of chars above times length)
    -- and shuffle it
    SELECT c FROM chars, generate_series(1, length) ORDER BY random()
)
SELECT substr(string_agg(b, ''), 1, length) FROM bricks;
$$
SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.854 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,6,"idle",2024-01-28 19:03:23 UTC,7/22,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_application_user(username text)
 RETURNS text
 LANGUAGE plpgsql
AS $function$
DECLARE
    pw text;
BEGIN
    SELECT user_management.random_password(20) INTO pw;
    EXECUTE format($$ CREATE USER %I WITH PASSWORD %L $$, username, pw);
    RETURN pw;
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.856 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,7,"idle",2024-01-28 19:03:23 UTC,7/23,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_application_user(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.856 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,8,"idle",2024-01-28 19:03:23 UTC,7/24,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_application_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.857 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,9,"idle",2024-01-28 19:03:23 UTC,7/25,0,LOG,00000,"statement: COMMENT ON FUNCTION create_application_user(text) IS 'Creates a user that can login, sets the password to a strong random one,
which is then returned';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.857 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,10,"idle",2024-01-28 19:03:23 UTC,7/26,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_user(username text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    EXECUTE format($$ CREATE USER %I IN ROLE zalandos, admin $$, username);
    EXECUTE format($$ ALTER ROLE %I SET log_statement TO 'all' $$, username);
END;
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.857 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,11,"idle",2024-01-28 19:03:23 UTC,7/27,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_user(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.858 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,12,"idle",2024-01-28 19:03:23 UTC,7/28,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.858 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,13,"idle",2024-01-28 19:03:23 UTC,7/29,0,LOG,00000,"statement: COMMENT ON FUNCTION create_user(text) IS 'Creates a user that is supposed to be a human, to be authenticated without a password';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.858 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,14,"idle",2024-01-28 19:03:23 UTC,7/30,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_role(rolename text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    -- set ADMIN to the admin user, so every member of admin can GRANT these roles to each other
    EXECUTE format($$ CREATE ROLE %I WITH ADMIN admin $$, rolename);
END;
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.859 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,15,"idle",2024-01-28 19:03:23 UTC,7/31,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_role(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.859 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,16,"idle",2024-01-28 19:03:23 UTC,7/32,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_role(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.860 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,17,"idle",2024-01-28 19:03:23 UTC,7/33,0,LOG,00000,"statement: COMMENT ON FUNCTION create_role(text) IS 'Creates a role that cannot log in, but can be used to set up fine-grained privileges';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.860 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,18,"idle",2024-01-28 19:03:23 UTC,7/34,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_application_user_or_change_password(username text, password text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    PERFORM 1 FROM pg_roles WHERE rolname = username;

    IF FOUND
    THEN
        EXECUTE format($$ ALTER ROLE %I WITH PASSWORD %L $$, username, password);
    ELSE
        EXECUTE format($$ CREATE USER %I WITH PASSWORD %L $$, username, password);
    END IF;
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.860 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,19,"idle",2024-01-28 19:03:23 UTC,7/35,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_application_user_or_change_password(text, text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.860 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,20,"idle",2024-01-28 19:03:23 UTC,7/36,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_application_user_or_change_password(text, text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.861 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,21,"idle",2024-01-28 19:03:23 UTC,7/37,0,LOG,00000,"statement: COMMENT ON FUNCTION create_application_user_or_change_password(text, text) IS 'USE THIS ONLY IN EMERGENCY!  The password will appear in the DB logs.
Creates a user that can login, sets the password to the one provided.
If the user already exists, sets its password.';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.861 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,22,"idle",2024-01-28 19:03:23 UTC,7/38,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION revoke_admin(username text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    EXECUTE format($$ REVOKE admin FROM %I $$, username);
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.861 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,23,"idle",2024-01-28 19:03:23 UTC,7/39,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION revoke_admin(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.861 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,24,"idle",2024-01-28 19:03:23 UTC,7/40,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION revoke_admin(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.862 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,25,"idle",2024-01-28 19:03:23 UTC,7/41,0,LOG,00000,"statement: COMMENT ON FUNCTION revoke_admin(text) IS 'Use this function to make a human user less privileged,
ie. when you want to grant someone read privileges only';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.862 UTC,,,137,"[local]",65b6a4fb.89,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.862 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,26,"idle",2024-01-28 19:03:23 UTC,7/42,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION drop_user(username text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    EXECUTE format($$ DROP ROLE %I $$, username);
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.863 UTC,"postgres","template1",137,"[local]",65b6a4fb.89,2,"authentication",2024-01-28 19:03:23 UTC,6/94,0,LOG,00000,"connection authorized: user=postgres database=template1 application_name=psql",,,,,,,,,"","client backend",,5558883919402895063
2024-01-28 19:03:23.863 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,27,"idle",2024-01-28 19:03:23 UTC,7/43,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION drop_user(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.864 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,28,"idle",2024-01-28 19:03:23 UTC,7/44,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION drop_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.864 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,29,"idle",2024-01-28 19:03:23 UTC,7/45,0,LOG,00000,"statement: COMMENT ON FUNCTION drop_user(text) IS 'Drop a human or application user.  Intended for cleanup (either after team changes or mistakes in role setup).
Roles (= users) that own database objects cannot be dropped.';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.865 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,30,"idle",2024-01-28 19:03:23 UTC,7/46,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION drop_role(username text)
 RETURNS void
 LANGUAGE sql
AS $function$
SELECT user_management.drop_user(username);
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.865 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,31,"idle",2024-01-28 19:03:23 UTC,7/47,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION drop_role(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.866 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,32,"idle",2024-01-28 19:03:23 UTC,7/48,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION drop_role(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.866 UTC,"postgres","template1",137,"[local]",65b6a4fb.89,3,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=template1 host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.866 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,33,"idle",2024-01-28 19:03:23 UTC,7/49,0,LOG,00000,"statement: COMMENT ON FUNCTION drop_role(text) IS 'Drop a human or application user.  Intended for cleanup (either after team changes or mistakes in role setup).
Roles (= users) that own database objects cannot be dropped.';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.867 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,34,"idle",2024-01-28 19:03:23 UTC,7/50,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION terminate_backend(pid integer)
 RETURNS boolean
 LANGUAGE sql
AS $function$
SELECT pg_terminate_backend(pid);
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.868 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,35,"idle",2024-01-28 19:03:23 UTC,7/51,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION terminate_backend(integer) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.868 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,36,"idle",2024-01-28 19:03:23 UTC,7/52,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION terminate_backend(integer) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.869 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,37,"idle",2024-01-28 19:03:23 UTC,7/53,0,LOG,00000,"statement: COMMENT ON FUNCTION terminate_backend(integer) IS 'When there is a process causing harm, you can kill it using this function.  Get the pid from pg_stat_activity
(be careful to match the user name (usename) and the query, in order not to kill innocent kittens) and pass it to terminate_backend()';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.869 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,38,"idle",2024-01-28 19:03:23 UTC,7/54,0,LOG,00000,"statement: GRANT SELECT ON pg_stat_activity TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.870 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,39,"idle",2024-01-28 19:03:23 UTC,7/56,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS pg_stat_statements SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.877 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,40,"idle",2024-01-28 19:03:23 UTC,7/57,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS pg_stat_kcache SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.881 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,41,"idle",2024-01-28 19:03:23 UTC,7/58,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS set_user SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.883 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,42,"idle",2024-01-28 19:03:23 UTC,7/59,0,LOG,00000,"statement: ALTER EXTENSION set_user UPDATE;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.883 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,43,"idle",2024-01-28 19:03:23 UTC,7/60,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION public.set_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.883 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,44,"idle",2024-01-28 19:03:23 UTC,7/61,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION public.pg_stat_statements_reset(oid, oid, bigint) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.883 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,45,"idle",2024-01-28 19:03:23 UTC,7/62,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION pg_catalog.pg_switch_wal() TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.884 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,46,"idle",2024-01-28 19:03:23 UTC,7/63,0,LOG,00000,"statement: CREATE SCHEMA IF NOT EXISTS metric_helpers AUTHORIZATION postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.884 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,47,"idle",2024-01-28 19:03:23 UTC,7/64,0,LOG,00000,"statement: GRANT USAGE ON SCHEMA metric_helpers TO admin, robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.884 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,48,"idle",2024-01-28 19:03:23 UTC,7/66,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION get_table_bloat_approx (
    OUT t_database name,
    OUT t_schema_name name,
    OUT t_table_name name,
    OUT t_real_size numeric,
    OUT t_extra_size double precision,
    OUT t_extra_ratio double precision,
    OUT t_fill_factor integer,
    OUT t_bloat_size double precision,
    OUT t_bloat_ratio double precision,
    OUT t_is_na boolean
) RETURNS SETOF record AS
$_$
SELECT
  current_database(),
  schemaname,
  tblname,
  (bs*tblpages) AS real_size,
  ((tblpages-est_tblpages)*bs) AS extra_size,
  CASE WHEN tblpages - est_tblpages > 0
    THEN 100 * (tblpages - est_tblpages)/tblpages::float
    ELSE 0
  END AS extra_ratio,
  fillfactor,
  CASE WHEN tblpages - est_tblpages_ff > 0
    THEN (tblpages-est_tblpages_ff)*bs
    ELSE 0
  END AS bloat_size,
  CASE WHEN tblpages - est_tblpages_ff > 0
    THEN 100 * (tblpages - est_tblpages_ff)/tblpages::float
    ELSE 0
  END AS bloat_ratio,
  is_na
FROM (
  SELECT ceil( reltuples / ( (bs-page_hdr)/tpl_size ) ) + ceil( toasttuples / 4 ) AS est_tblpages,
    ceil( reltuples / ( (bs-page_hdr)*fillfactor/(tpl_size*100) ) ) + ceil( toasttuples / 4 ) AS est_tblpages_ff,
    tblpages, fillfactor, bs, tblid, schemaname, tblname, heappages, toastpages, is_na
    -- , tpl_hdr_size, tpl_data_size, pgstattuple(tblid) AS pst -- (DEBUG INFO)
  FROM (
    SELECT
      ( 4 + tpl_hdr_size + tpl_data_size + (2*ma)
        - CASE WHEN tpl_hdr_size%ma = 0 THEN ma ELSE tpl_hdr_size%ma END
        - CASE WHEN ceil(tpl_data_size)::int%ma = 0 THEN ma ELSE ceil(tpl_data_size)::int%ma END
      ) AS tpl_size, bs - page_hdr AS size_per_block, (heappages + toastpages) AS tblpages, heappages,
      toastpages, reltuples, toasttuples, bs, page_hdr, tblid, schemaname, tblname, fillfactor, is_na
      -- , tpl_hdr_size, tpl_data_size
    FROM (
      SELECT
        tbl.oid AS tblid, ns.nspname AS schemaname, tbl.relname AS tblname, tbl.reltuples,
        tbl.relpages AS heappages, coalesce(toast.relpages, 0) AS toastpages,
        coalesce(toast.reltuples, 0) AS toasttuples,
        coalesce(substring(
          array_to_string(tbl.reloptions, ' ')
          FROM 'fillfactor=([0-9]+)')::smallint, 100) AS fillfactor,
        current_setting('block_size')::numeric AS bs,
        CASE WHEN version()~'mingw32' OR version()~'64-bit|x86_64|ppc64|ia64|amd64' THEN 8 ELSE 4 END AS ma,
        24 AS page_hdr,
        23 + CASE WHEN MAX(coalesce(s.null_frac,0)) > 0 THEN ( 7 + count(s.attname) ) / 8 ELSE 0::int END
           + CASE WHEN bool_or(att.attname = 'oid' and att.attnum < 0) THEN 4 ELSE 0 END AS tpl_hdr_size,
        sum( (1-coalesce(s.null_frac, 0)) * coalesce(s.avg_width, 0) ) AS tpl_data_size,
        bool_or(att.atttypid = 'pg_catalog.name'::regtype)
          OR sum(CASE WHEN att.attnum > 0 THEN 1 ELSE 0 END) <> count(s.attname) AS is_na
      FROM pg_attribute AS att
        JOIN pg_class AS tbl ON att.attrelid = tbl.oid
        JOIN pg_namespace AS ns ON ns.oid = tbl.relnamespace
        LEFT JOIN pg_stats AS s ON s.schemaname=ns.nspname
          AND s.tablename = tbl.relname AND s.inherited=false AND s.attname=att.attname
        LEFT JOIN pg_class AS toast ON tbl.reltoastrelid = toast.oid
      WHERE NOT att.attisdropped
        AND tbl.relkind = 'r'
      GROUP BY 1,2,3,4,5,6,7,8,9,10
      ORDER BY 2,3
    ) AS s
  ) AS s2
) AS s3 WHERE schemaname NOT LIKE 'information_schema';
$_$ LANGUAGE sql SECURITY DEFINER IMMUTABLE STRICT SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.886 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,49,"idle",2024-01-28 19:03:23 UTC,7/67,0,LOG,00000,"statement: CREATE OR REPLACE VIEW table_bloat AS SELECT * FROM get_table_bloat_approx();",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.887 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,50,"idle",2024-01-28 19:03:23 UTC,7/68,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION get_btree_bloat_approx (
    OUT i_database name,
    OUT i_schema_name name,
    OUT i_table_name name,
    OUT i_index_name name,
    OUT i_real_size numeric,
    OUT i_extra_size numeric,
    OUT i_extra_ratio double precision,
    OUT i_fill_factor integer,
    OUT i_bloat_size double precision,
    OUT i_bloat_ratio double precision,
    OUT i_is_na boolean
) RETURNS SETOF record AS
$_$
SELECT current_database(), nspname AS schemaname, tblname, idxname, bs*(relpages)::bigint AS real_size,
  bs*(relpages-est_pages)::bigint AS extra_size,
  100 * (relpages-est_pages)::float / relpages AS extra_ratio,
  fillfactor,
  CASE WHEN relpages > est_pages_ff
    THEN bs*(relpages-est_pages_ff)
    ELSE 0
  END AS bloat_size,
  100 * (relpages-est_pages_ff)::float / relpages AS bloat_ratio,
  is_na
  -- , 100-(pst).avg_leaf_density AS pst_avg_bloat, est_pages, index_tuple_hdr_bm, maxalign, pagehdr, nulldatawidth, nulldatahdrwidth, reltuples, relpages -- (DEBUG INFO)
FROM (
  SELECT coalesce(1 +
         ceil(reltuples/floor((bs-pageopqdata-pagehdr)/(4+nulldatahdrwidth)::float)), 0 -- ItemIdData size + computed avg size of a tuple (nulldatahdrwidth)
      ) AS est_pages,
      coalesce(1 +
         ceil(reltuples/floor((bs-pageopqdata-pagehdr)*fillfactor/(100*(4+nulldatahdrwidth)::float))), 0
      ) AS est_pages_ff,
      bs, nspname, tblname, idxname, relpages, fillfactor, is_na
      -- , pgstatindex(idxoid) AS pst, index_tuple_hdr_bm, maxalign, pagehdr, nulldatawidth, nulldatahdrwidth, reltuples -- (DEBUG INFO)
  FROM (
      SELECT maxalign, bs, nspname, tblname, idxname, reltuples, relpages, idxoid, fillfactor,
            ( index_tuple_hdr_bm +
                maxalign - CASE -- Add padding to the index tuple header to align on MAXALIGN
                  WHEN index_tuple_hdr_bm%maxalign = 0 THEN maxalign
                  ELSE index_tuple_hdr_bm%maxalign
                END
              + nulldatawidth + maxalign - CASE -- Add padding to the data to align on MAXALIGN
                  WHEN nulldatawidth = 0 THEN 0
                  WHEN nulldatawidth::integer%maxalign = 0 THEN maxalign
                  ELSE nulldatawidth::integer%maxalign
                END
            )::numeric AS nulldatahdrwidth, pagehdr, pageopqdata, is_na
            -- , index_tuple_hdr_bm, nulldatawidth -- (DEBUG INFO)
      FROM (
          SELECT n.nspname, ct.relname AS tblname, i.idxname, i.reltuples, i.relpages,
              i.idxoid, i.fillfactor, current_setting('block_size')::numeric AS bs,
              CASE -- MAXALIGN: 4 on 32bits, 8 on 64bits (and mingw32 ?)
                WHEN version() ~ 'mingw32' OR version() ~ '64-bit|x86_64|ppc64|ia64|amd64' THEN 8
                ELSE 4
              END AS maxalign,
              /* per page header, fixed size: 20 for 7.X, 24 for others */
              24 AS pagehdr,
              /* per page btree opaque data */
              16 AS pageopqdata,
              /* per tuple header: add IndexAttributeBitMapData if some cols are null-able */
              CASE WHEN max(coalesce(s.stanullfrac,0)) = 0
                  THEN 2 -- IndexTupleData size
                  ELSE 2 + (( 32 + 8 - 1 ) / 8) -- IndexTupleData size + IndexAttributeBitMapData size ( max num filed per index + 8 - 1 /8)
              END AS index_tuple_hdr_bm,
              /* data len: we remove null values save space using it fractionnal part from stats */
              sum( (1-coalesce(s.stanullfrac, 0)) * coalesce(s.stawidth, 1024)) AS nulldatawidth,
              max( CASE WHEN a.atttypid = 'pg_catalog.name'::regtype THEN 1 ELSE 0 END ) > 0 AS is_na
          FROM (
              SELECT idxname, reltuples, relpages, tbloid, idxoid, fillfactor,
                  CASE WHEN indkey[i]=0 THEN idxoid ELSE tbloid END AS att_rel,
                  CASE WHEN indkey[i]=0 THEN i ELSE indkey[i] END AS att_pos
              FROM (
                  SELECT idxname, reltuples, relpages, tbloid, idxoid, fillfactor, indkey, generate_series(1,indnatts) AS i
                  FROM (
                      SELECT ci.relname AS idxname, ci.reltuples, ci.relpages, i.indrelid AS tbloid,
                          i.indexrelid AS idxoid,
                          coalesce(substring(
                              array_to_string(ci.reloptions, ' ')
                              from 'fillfactor=([0-9]+)')::smallint, 90) AS fillfactor,
                          i.indnatts,
                          string_to_array(textin(int2vectorout(i.indkey)),' ')::int[] AS indkey
                      FROM pg_index i
                      JOIN pg_class ci ON ci.oid=i.indexrelid
                      WHERE ci.relam=(SELECT oid FROM pg_am WHERE amname = 'btree')
                        AND ci.relpages > 0
                  ) AS idx_data
              ) AS idx_data_cross
          ) i
          JOIN pg_attribute a ON a.attrelid = i.att_rel
                             AND a.attnum = i.att_pos
          JOIN pg_statistic s ON s.starelid = i.att_rel
                             AND s.staattnum = i.att_pos
          JOIN pg_class ct ON ct.oid = i.tbloid
          JOIN pg_namespace n ON ct.relnamespace = n.oid
          GROUP BY 1,2,3,4,5,6,7,8,9,10
      ) AS rows_data_stats
  ) AS rows_hdr_pdg_stats
) AS relation_stats;
$_$ LANGUAGE sql SECURITY DEFINER IMMUTABLE STRICT SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.892 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,51,"idle",2024-01-28 19:03:23 UTC,7/69,0,LOG,00000,"statement: CREATE OR REPLACE VIEW index_bloat AS SELECT * FROM get_btree_bloat_approx();",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.893 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,52,"idle",2024-01-28 19:03:23 UTC,7/70,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION pg_stat_statements(showtext boolean) RETURNS SETOF public.pg_stat_statements AS
$$
  SELECT * FROM public.pg_stat_statements(showtext);
$$ LANGUAGE sql IMMUTABLE SECURITY DEFINER STRICT;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.893 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,53,"idle",2024-01-28 19:03:23 UTC,7/71,0,LOG,00000,"statement: CREATE OR REPLACE VIEW pg_stat_statements AS SELECT * FROM pg_stat_statements(true);",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.894 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,54,"idle",2024-01-28 19:03:23 UTC,7/72,0,LOG,00000,"statement: REVOKE ALL ON ALL TABLES IN SCHEMA metric_helpers FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.894 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,55,"idle",2024-01-28 19:03:23 UTC,7/73,0,LOG,00000,"statement: GRANT SELECT ON ALL TABLES IN SCHEMA metric_helpers TO admin, robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.895 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,56,"idle",2024-01-28 19:03:23 UTC,7/74,0,LOG,00000,"statement: REVOKE ALL ON ALL FUNCTIONS IN SCHEMA metric_helpers FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.895 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,57,"idle",2024-01-28 19:03:23 UTC,7/75,0,LOG,00000,"statement: GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA metric_helpers TO admin, robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.896 UTC,,,141,"[local]",65b6a4fb.8d,1,"",2024-01-28 19:03:23 UTC,,0,LOG,00000,"connection received: host=[local]",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:23.897 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,2,"authentication",2024-01-28 19:03:23 UTC,8/1,0,LOG,00000,"connection authorized: user=postgres database=template1 application_name=psql",,,,,,,,,"","client backend",,0
2024-01-28 19:03:23.898 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,3,"idle",2024-01-28 19:03:23 UTC,8/2,0,LOG,00000,"statement: CREATE SCHEMA IF NOT EXISTS user_management;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.898 UTC,"postgres","postgres",136,"[local]",65b6a4fb.88,58,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.048 user=postgres database=postgres host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.899 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,4,"idle",2024-01-28 19:03:23 UTC,8/3,0,LOG,00000,"statement: GRANT USAGE ON SCHEMA user_management TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.899 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,5,"idle",2024-01-28 19:03:23 UTC,8/5,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION random_password (length integer) RETURNS text LANGUAGE sql AS
$$
WITH chars (c) AS (
    SELECT chr(33)
    UNION ALL
    SELECT chr(i) FROM generate_series (35, 38) AS t (i)
    UNION ALL
    SELECT chr(i) FROM generate_series (42, 90) AS t (i)
    UNION ALL
    SELECT chr(i) FROM generate_series (97, 122) AS t (i)
),
bricks (b) AS (
    -- build a pool of chars (the size will be the number of chars above times length)
    -- and shuffle it
    SELECT c FROM chars, generate_series(1, length) ORDER BY random()
)
SELECT substr(string_agg(b, ''), 1, length) FROM bricks;
$$
SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.903 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,6,"idle",2024-01-28 19:03:23 UTC,8/6,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_application_user(username text)
 RETURNS text
 LANGUAGE plpgsql
AS $function$
DECLARE
    pw text;
BEGIN
    SELECT user_management.random_password(20) INTO pw;
    EXECUTE format($$ CREATE USER %I WITH PASSWORD %L $$, username, pw);
    RETURN pw;
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.905 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,7,"idle",2024-01-28 19:03:23 UTC,8/7,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_application_user(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.905 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,8,"idle",2024-01-28 19:03:23 UTC,8/8,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_application_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.906 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,9,"idle",2024-01-28 19:03:23 UTC,8/9,0,LOG,00000,"statement: COMMENT ON FUNCTION create_application_user(text) IS 'Creates a user that can login, sets the password to a strong random one,
which is then returned';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.907 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,10,"idle",2024-01-28 19:03:23 UTC,8/10,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_user(username text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    EXECUTE format($$ CREATE USER %I IN ROLE zalandos, admin $$, username);
    EXECUTE format($$ ALTER ROLE %I SET log_statement TO 'all' $$, username);
END;
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.908 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,11,"idle",2024-01-28 19:03:23 UTC,8/11,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_user(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.908 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,12,"idle",2024-01-28 19:03:23 UTC,8/12,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.909 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,13,"idle",2024-01-28 19:03:23 UTC,8/13,0,LOG,00000,"statement: COMMENT ON FUNCTION create_user(text) IS 'Creates a user that is supposed to be a human, to be authenticated without a password';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.909 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,14,"idle",2024-01-28 19:03:23 UTC,8/14,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_role(rolename text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    -- set ADMIN to the admin user, so every member of admin can GRANT these roles to each other
    EXECUTE format($$ CREATE ROLE %I WITH ADMIN admin $$, rolename);
END;
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.910 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,15,"idle",2024-01-28 19:03:23 UTC,8/15,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_role(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.910 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,16,"idle",2024-01-28 19:03:23 UTC,8/16,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_role(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.910 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,17,"idle",2024-01-28 19:03:23 UTC,8/17,0,LOG,00000,"statement: COMMENT ON FUNCTION create_role(text) IS 'Creates a role that cannot log in, but can be used to set up fine-grained privileges';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.911 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,18,"idle",2024-01-28 19:03:23 UTC,8/18,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION create_application_user_or_change_password(username text, password text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    PERFORM 1 FROM pg_roles WHERE rolname = username;

    IF FOUND
    THEN
        EXECUTE format($$ ALTER ROLE %I WITH PASSWORD %L $$, username, password);
    ELSE
        EXECUTE format($$ CREATE USER %I WITH PASSWORD %L $$, username, password);
    END IF;
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.911 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,19,"idle",2024-01-28 19:03:23 UTC,8/19,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION create_application_user_or_change_password(text, text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.911 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,20,"idle",2024-01-28 19:03:23 UTC,8/20,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION create_application_user_or_change_password(text, text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.912 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,21,"idle",2024-01-28 19:03:23 UTC,8/21,0,LOG,00000,"statement: COMMENT ON FUNCTION create_application_user_or_change_password(text, text) IS 'USE THIS ONLY IN EMERGENCY!  The password will appear in the DB logs.
Creates a user that can login, sets the password to the one provided.
If the user already exists, sets its password.';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.912 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,22,"idle",2024-01-28 19:03:23 UTC,8/22,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION revoke_admin(username text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    EXECUTE format($$ REVOKE admin FROM %I $$, username);
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.912 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,23,"idle",2024-01-28 19:03:23 UTC,8/23,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION revoke_admin(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.913 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,24,"idle",2024-01-28 19:03:23 UTC,8/24,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION revoke_admin(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.913 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,25,"idle",2024-01-28 19:03:23 UTC,8/25,0,LOG,00000,"statement: COMMENT ON FUNCTION revoke_admin(text) IS 'Use this function to make a human user less privileged,
ie. when you want to grant someone read privileges only';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.913 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,26,"idle",2024-01-28 19:03:23 UTC,8/26,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION drop_user(username text)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
    EXECUTE format($$ DROP ROLE %I $$, username);
END
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.914 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,27,"idle",2024-01-28 19:03:23 UTC,8/27,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION drop_user(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.914 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,28,"idle",2024-01-28 19:03:23 UTC,8/28,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION drop_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.914 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,29,"idle",2024-01-28 19:03:23 UTC,8/29,0,LOG,00000,"statement: COMMENT ON FUNCTION drop_user(text) IS 'Drop a human or application user.  Intended for cleanup (either after team changes or mistakes in role setup).
Roles (= users) that own database objects cannot be dropped.';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.915 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,30,"idle",2024-01-28 19:03:23 UTC,8/30,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION drop_role(username text)
 RETURNS void
 LANGUAGE sql
AS $function$
SELECT user_management.drop_user(username);
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.915 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,31,"idle",2024-01-28 19:03:23 UTC,8/31,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION drop_role(text) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.915 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,32,"idle",2024-01-28 19:03:23 UTC,8/32,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION drop_role(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.915 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,33,"idle",2024-01-28 19:03:23 UTC,8/33,0,LOG,00000,"statement: COMMENT ON FUNCTION drop_role(text) IS 'Drop a human or application user.  Intended for cleanup (either after team changes or mistakes in role setup).
Roles (= users) that own database objects cannot be dropped.';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.915 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,34,"idle",2024-01-28 19:03:23 UTC,8/34,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION terminate_backend(pid integer)
 RETURNS boolean
 LANGUAGE sql
AS $function$
SELECT pg_terminate_backend(pid);
$function$
SECURITY DEFINER SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.916 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,35,"idle",2024-01-28 19:03:23 UTC,8/35,0,LOG,00000,"statement: REVOKE ALL ON FUNCTION terminate_backend(integer) FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.916 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,36,"idle",2024-01-28 19:03:23 UTC,8/36,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION terminate_backend(integer) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.916 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,37,"idle",2024-01-28 19:03:23 UTC,8/37,0,LOG,00000,"statement: COMMENT ON FUNCTION terminate_backend(integer) IS 'When there is a process causing harm, you can kill it using this function.  Get the pid from pg_stat_activity
(be careful to match the user name (usename) and the query, in order not to kill innocent kittens) and pass it to terminate_backend()';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.916 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,38,"idle",2024-01-28 19:03:23 UTC,8/38,0,LOG,00000,"statement: GRANT SELECT ON pg_stat_activity TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.919 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,39,"idle",2024-01-28 19:03:23 UTC,8/40,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS pg_stat_statements SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.933 UTC,,,140,,65b6a4fb.8c,1,,2024-01-28 19:03:23 UTC,6/98,904,LOG,00000,"automatic analyze of table ""postgres.pg_catalog.pg_attribute""
avg read rate: 18.842 MB/s, avg write rate: 9.651 MB/s
buffer usage: 1065 hits, 41 misses, 21 dirtied
system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.01 s",,,,,,,,,"","autovacuum worker",,0
2024-01-28 19:03:23.935 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,40,"idle",2024-01-28 19:03:23 UTC,8/41,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS pg_stat_kcache SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.940 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,41,"idle",2024-01-28 19:03:23 UTC,8/42,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS set_user SCHEMA public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.941 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,42,"idle",2024-01-28 19:03:23 UTC,8/43,0,LOG,00000,"statement: ALTER EXTENSION set_user UPDATE;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.941 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,43,"idle",2024-01-28 19:03:23 UTC,8/44,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION public.set_user(text) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.941 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,44,"idle",2024-01-28 19:03:23 UTC,8/45,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION public.pg_stat_statements_reset(oid, oid, bigint) TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.941 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,45,"idle",2024-01-28 19:03:23 UTC,8/46,0,LOG,00000,"statement: GRANT EXECUTE ON FUNCTION pg_catalog.pg_switch_wal() TO admin;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.942 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,46,"idle",2024-01-28 19:03:23 UTC,8/47,0,LOG,00000,"statement: CREATE SCHEMA IF NOT EXISTS metric_helpers AUTHORIZATION postgres;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.943 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,47,"idle",2024-01-28 19:03:23 UTC,8/48,0,LOG,00000,"statement: GRANT USAGE ON SCHEMA metric_helpers TO admin, robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.943 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,48,"idle",2024-01-28 19:03:23 UTC,8/50,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION get_table_bloat_approx (
    OUT t_database name,
    OUT t_schema_name name,
    OUT t_table_name name,
    OUT t_real_size numeric,
    OUT t_extra_size double precision,
    OUT t_extra_ratio double precision,
    OUT t_fill_factor integer,
    OUT t_bloat_size double precision,
    OUT t_bloat_ratio double precision,
    OUT t_is_na boolean
) RETURNS SETOF record AS
$_$
SELECT
  current_database(),
  schemaname,
  tblname,
  (bs*tblpages) AS real_size,
  ((tblpages-est_tblpages)*bs) AS extra_size,
  CASE WHEN tblpages - est_tblpages > 0
    THEN 100 * (tblpages - est_tblpages)/tblpages::float
    ELSE 0
  END AS extra_ratio,
  fillfactor,
  CASE WHEN tblpages - est_tblpages_ff > 0
    THEN (tblpages-est_tblpages_ff)*bs
    ELSE 0
  END AS bloat_size,
  CASE WHEN tblpages - est_tblpages_ff > 0
    THEN 100 * (tblpages - est_tblpages_ff)/tblpages::float
    ELSE 0
  END AS bloat_ratio,
  is_na
FROM (
  SELECT ceil( reltuples / ( (bs-page_hdr)/tpl_size ) ) + ceil( toasttuples / 4 ) AS est_tblpages,
    ceil( reltuples / ( (bs-page_hdr)*fillfactor/(tpl_size*100) ) ) + ceil( toasttuples / 4 ) AS est_tblpages_ff,
    tblpages, fillfactor, bs, tblid, schemaname, tblname, heappages, toastpages, is_na
    -- , tpl_hdr_size, tpl_data_size, pgstattuple(tblid) AS pst -- (DEBUG INFO)
  FROM (
    SELECT
      ( 4 + tpl_hdr_size + tpl_data_size + (2*ma)
        - CASE WHEN tpl_hdr_size%ma = 0 THEN ma ELSE tpl_hdr_size%ma END
        - CASE WHEN ceil(tpl_data_size)::int%ma = 0 THEN ma ELSE ceil(tpl_data_size)::int%ma END
      ) AS tpl_size, bs - page_hdr AS size_per_block, (heappages + toastpages) AS tblpages, heappages,
      toastpages, reltuples, toasttuples, bs, page_hdr, tblid, schemaname, tblname, fillfactor, is_na
      -- , tpl_hdr_size, tpl_data_size
    FROM (
      SELECT
        tbl.oid AS tblid, ns.nspname AS schemaname, tbl.relname AS tblname, tbl.reltuples,
        tbl.relpages AS heappages, coalesce(toast.relpages, 0) AS toastpages,
        coalesce(toast.reltuples, 0) AS toasttuples,
        coalesce(substring(
          array_to_string(tbl.reloptions, ' ')
          FROM 'fillfactor=([0-9]+)')::smallint, 100) AS fillfactor,
        current_setting('block_size')::numeric AS bs,
        CASE WHEN version()~'mingw32' OR version()~'64-bit|x86_64|ppc64|ia64|amd64' THEN 8 ELSE 4 END AS ma,
        24 AS page_hdr,
        23 + CASE WHEN MAX(coalesce(s.null_frac,0)) > 0 THEN ( 7 + count(s.attname) ) / 8 ELSE 0::int END
           + CASE WHEN bool_or(att.attname = 'oid' and att.attnum < 0) THEN 4 ELSE 0 END AS tpl_hdr_size,
        sum( (1-coalesce(s.null_frac, 0)) * coalesce(s.avg_width, 0) ) AS tpl_data_size,
        bool_or(att.atttypid = 'pg_catalog.name'::regtype)
          OR sum(CASE WHEN att.attnum > 0 THEN 1 ELSE 0 END) <> count(s.attname) AS is_na
      FROM pg_attribute AS att
        JOIN pg_class AS tbl ON att.attrelid = tbl.oid
        JOIN pg_namespace AS ns ON ns.oid = tbl.relnamespace
        LEFT JOIN pg_stats AS s ON s.schemaname=ns.nspname
          AND s.tablename = tbl.relname AND s.inherited=false AND s.attname=att.attname
        LEFT JOIN pg_class AS toast ON tbl.reltoastrelid = toast.oid
      WHERE NOT att.attisdropped
        AND tbl.relkind = 'r'
      GROUP BY 1,2,3,4,5,6,7,8,9,10
      ORDER BY 2,3
    ) AS s
  ) AS s2
) AS s3 WHERE schemaname NOT LIKE 'information_schema';
$_$ LANGUAGE sql SECURITY DEFINER IMMUTABLE STRICT SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.946 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,49,"idle",2024-01-28 19:03:23 UTC,8/51,0,LOG,00000,"statement: CREATE OR REPLACE VIEW table_bloat AS SELECT * FROM get_table_bloat_approx();",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.947 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,50,"idle",2024-01-28 19:03:23 UTC,8/52,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION get_btree_bloat_approx (
    OUT i_database name,
    OUT i_schema_name name,
    OUT i_table_name name,
    OUT i_index_name name,
    OUT i_real_size numeric,
    OUT i_extra_size numeric,
    OUT i_extra_ratio double precision,
    OUT i_fill_factor integer,
    OUT i_bloat_size double precision,
    OUT i_bloat_ratio double precision,
    OUT i_is_na boolean
) RETURNS SETOF record AS
$_$
SELECT current_database(), nspname AS schemaname, tblname, idxname, bs*(relpages)::bigint AS real_size,
  bs*(relpages-est_pages)::bigint AS extra_size,
  100 * (relpages-est_pages)::float / relpages AS extra_ratio,
  fillfactor,
  CASE WHEN relpages > est_pages_ff
    THEN bs*(relpages-est_pages_ff)
    ELSE 0
  END AS bloat_size,
  100 * (relpages-est_pages_ff)::float / relpages AS bloat_ratio,
  is_na
  -- , 100-(pst).avg_leaf_density AS pst_avg_bloat, est_pages, index_tuple_hdr_bm, maxalign, pagehdr, nulldatawidth, nulldatahdrwidth, reltuples, relpages -- (DEBUG INFO)
FROM (
  SELECT coalesce(1 +
         ceil(reltuples/floor((bs-pageopqdata-pagehdr)/(4+nulldatahdrwidth)::float)), 0 -- ItemIdData size + computed avg size of a tuple (nulldatahdrwidth)
      ) AS est_pages,
      coalesce(1 +
         ceil(reltuples/floor((bs-pageopqdata-pagehdr)*fillfactor/(100*(4+nulldatahdrwidth)::float))), 0
      ) AS est_pages_ff,
      bs, nspname, tblname, idxname, relpages, fillfactor, is_na
      -- , pgstatindex(idxoid) AS pst, index_tuple_hdr_bm, maxalign, pagehdr, nulldatawidth, nulldatahdrwidth, reltuples -- (DEBUG INFO)
  FROM (
      SELECT maxalign, bs, nspname, tblname, idxname, reltuples, relpages, idxoid, fillfactor,
            ( index_tuple_hdr_bm +
                maxalign - CASE -- Add padding to the index tuple header to align on MAXALIGN
                  WHEN index_tuple_hdr_bm%maxalign = 0 THEN maxalign
                  ELSE index_tuple_hdr_bm%maxalign
                END
              + nulldatawidth + maxalign - CASE -- Add padding to the data to align on MAXALIGN
                  WHEN nulldatawidth = 0 THEN 0
                  WHEN nulldatawidth::integer%maxalign = 0 THEN maxalign
                  ELSE nulldatawidth::integer%maxalign
                END
            )::numeric AS nulldatahdrwidth, pagehdr, pageopqdata, is_na
            -- , index_tuple_hdr_bm, nulldatawidth -- (DEBUG INFO)
      FROM (
          SELECT n.nspname, ct.relname AS tblname, i.idxname, i.reltuples, i.relpages,
              i.idxoid, i.fillfactor, current_setting('block_size')::numeric AS bs,
              CASE -- MAXALIGN: 4 on 32bits, 8 on 64bits (and mingw32 ?)
                WHEN version() ~ 'mingw32' OR version() ~ '64-bit|x86_64|ppc64|ia64|amd64' THEN 8
                ELSE 4
              END AS maxalign,
              /* per page header, fixed size: 20 for 7.X, 24 for others */
              24 AS pagehdr,
              /* per page btree opaque data */
              16 AS pageopqdata,
              /* per tuple header: add IndexAttributeBitMapData if some cols are null-able */
              CASE WHEN max(coalesce(s.stanullfrac,0)) = 0
                  THEN 2 -- IndexTupleData size
                  ELSE 2 + (( 32 + 8 - 1 ) / 8) -- IndexTupleData size + IndexAttributeBitMapData size ( max num filed per index + 8 - 1 /8)
              END AS index_tuple_hdr_bm,
              /* data len: we remove null values save space using it fractionnal part from stats */
              sum( (1-coalesce(s.stanullfrac, 0)) * coalesce(s.stawidth, 1024)) AS nulldatawidth,
              max( CASE WHEN a.atttypid = 'pg_catalog.name'::regtype THEN 1 ELSE 0 END ) > 0 AS is_na
          FROM (
              SELECT idxname, reltuples, relpages, tbloid, idxoid, fillfactor,
                  CASE WHEN indkey[i]=0 THEN idxoid ELSE tbloid END AS att_rel,
                  CASE WHEN indkey[i]=0 THEN i ELSE indkey[i] END AS att_pos
              FROM (
                  SELECT idxname, reltuples, relpages, tbloid, idxoid, fillfactor, indkey, generate_series(1,indnatts) AS i
                  FROM (
                      SELECT ci.relname AS idxname, ci.reltuples, ci.relpages, i.indrelid AS tbloid,
                          i.indexrelid AS idxoid,
                          coalesce(substring(
                              array_to_string(ci.reloptions, ' ')
                              from 'fillfactor=([0-9]+)')::smallint, 90) AS fillfactor,
                          i.indnatts,
                          string_to_array(textin(int2vectorout(i.indkey)),' ')::int[] AS indkey
                      FROM pg_index i
                      JOIN pg_class ci ON ci.oid=i.indexrelid
                      WHERE ci.relam=(SELECT oid FROM pg_am WHERE amname = 'btree')
                        AND ci.relpages > 0
                  ) AS idx_data
              ) AS idx_data_cross
          ) i
          JOIN pg_attribute a ON a.attrelid = i.att_rel
                             AND a.attnum = i.att_pos
          JOIN pg_statistic s ON s.starelid = i.att_rel
                             AND s.staattnum = i.att_pos
          JOIN pg_class ct ON ct.oid = i.tbloid
          JOIN pg_namespace n ON ct.relnamespace = n.oid
          GROUP BY 1,2,3,4,5,6,7,8,9,10
      ) AS rows_data_stats
  ) AS rows_hdr_pdg_stats
) AS relation_stats;
$_$ LANGUAGE sql SECURITY DEFINER IMMUTABLE STRICT SET search_path to 'pg_catalog';",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.948 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,51,"idle",2024-01-28 19:03:23 UTC,8/53,0,LOG,00000,"statement: CREATE OR REPLACE VIEW index_bloat AS SELECT * FROM get_btree_bloat_approx();",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.949 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,52,"idle",2024-01-28 19:03:23 UTC,8/54,0,LOG,00000,"statement: CREATE OR REPLACE FUNCTION pg_stat_statements(showtext boolean) RETURNS SETOF public.pg_stat_statements AS
$$
  SELECT * FROM public.pg_stat_statements(showtext);
$$ LANGUAGE sql IMMUTABLE SECURITY DEFINER STRICT;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.950 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,53,"idle",2024-01-28 19:03:23 UTC,8/55,0,LOG,00000,"statement: CREATE OR REPLACE VIEW pg_stat_statements AS SELECT * FROM pg_stat_statements(true);",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.951 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,54,"idle",2024-01-28 19:03:23 UTC,8/56,0,LOG,00000,"statement: REVOKE ALL ON ALL TABLES IN SCHEMA metric_helpers FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.951 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,55,"idle",2024-01-28 19:03:23 UTC,8/57,0,LOG,00000,"statement: GRANT SELECT ON ALL TABLES IN SCHEMA metric_helpers TO admin, robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.951 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,56,"idle",2024-01-28 19:03:23 UTC,8/58,0,LOG,00000,"statement: REVOKE ALL ON ALL FUNCTIONS IN SCHEMA metric_helpers FROM public;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.952 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,57,"idle",2024-01-28 19:03:23 UTC,8/59,0,LOG,00000,"statement: GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA metric_helpers TO admin, robot_zmon;",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.953 UTC,,,140,,65b6a4fb.8c,2,,2024-01-28 19:03:23 UTC,6/100,918,LOG,00000,"automatic analyze of table ""postgres.pg_catalog.pg_class""
avg read rate: 4.464 MB/s, avg write rate: 6.696 MB/s
buffer usage: 611 hits, 4 misses, 6 dirtied
system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s",,,,,,,,,"","autovacuum worker",,0
2024-01-28 19:03:23.953 UTC,"postgres","template1",141,"[local]",65b6a4fb.8d,58,"idle",2024-01-28 19:03:23 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.057 user=postgres database=template1 host=[local]",,,,,,,,,"psql","client backend",,0
2024-01-28 19:03:23.973 UTC,,,140,,65b6a4fb.8c,3,,2024-01-28 19:03:23 UTC,6/102,925,LOG,00000,"automatic analyze of table ""postgres.pg_catalog.pg_depend""
avg read rate: 41.667 MB/s, avg write rate: 4.340 MB/s
buffer usage: 153 hits, 48 misses, 5 dirtied
system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s",,,,,,,,,"","autovacuum worker",,0
2024-01-28 19:03:24.261 UTC,,,144,"10.42.2.6:47790",65b6a4fc.90,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47790",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.269 UTC,"postgres","postgres",144,"10.42.2.6:47790",65b6a4fc.90,2,"authentication",2024-01-28 19:03:24 UTC,6/104,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.269 UTC,"postgres","postgres",144,"10.42.2.6:47790",65b6a4fc.90,3,"authentication",2024-01-28 19:03:24 UTC,6/104,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.277 UTC,"postgres","postgres",144,"10.42.2.6:47790",65b6a4fc.90,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.016 user=postgres database=postgres host=10.42.2.6 port=47790",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.281 UTC,,,145,"10.42.2.6:47806",65b6a4fc.91,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47806",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.284 UTC,"postgres","postgres",145,"10.42.2.6:47806",65b6a4fc.91,2,"authentication",2024-01-28 19:03:24 UTC,6/106,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.284 UTC,"postgres","postgres",145,"10.42.2.6:47806",65b6a4fc.91,3,"authentication",2024-01-28 19:03:24 UTC,6/106,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.291 UTC,"postgres","postgres",145,"10.42.2.6:47806",65b6a4fc.91,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.010 user=postgres database=postgres host=10.42.2.6 port=47806",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.294 UTC,,,146,"10.42.2.6:47810",65b6a4fc.92,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47810",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.297 UTC,"postgres","postgres",146,"10.42.2.6:47810",65b6a4fc.92,2,"authentication",2024-01-28 19:03:24 UTC,6/109,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.297 UTC,"postgres","postgres",146,"10.42.2.6:47810",65b6a4fc.92,3,"authentication",2024-01-28 19:03:24 UTC,6/109,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.299 UTC,"postgres","postgres",146,"10.42.2.6:47810",65b6a4fc.92,4,"idle",2024-01-28 19:03:24 UTC,6/110,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_owner"" NOLOGIN ADMIN admin ENCRYPTED PASSWORD 'md53b71995495ed251910880b8e01348454';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.301 UTC,"postgres","postgres",146,"10.42.2.6:47810",65b6a4fc.92,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.006 user=postgres database=postgres host=10.42.2.6 port=47810",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.302 UTC,,,147,"10.42.2.6:47822",65b6a4fc.93,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47822",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.305 UTC,"postgres","postgres",147,"10.42.2.6:47822",65b6a4fc.93,2,"authentication",2024-01-28 19:03:24 UTC,6/111,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-2787719828875530358
2024-01-28 19:03:24.305 UTC,"postgres","postgres",147,"10.42.2.6:47822",65b6a4fc.93,3,"authentication",2024-01-28 19:03:24 UTC,6/111,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-2787719828875530358
2024-01-28 19:03:24.308 UTC,"postgres","postgres",147,"10.42.2.6:47822",65b6a4fc.93,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47822",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.310 UTC,,,148,"10.42.2.6:47834",65b6a4fc.94,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47834",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.313 UTC,"postgres","postgres",148,"10.42.2.6:47834",65b6a4fc.94,2,"authentication",2024-01-28 19:03:24 UTC,6/113,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,8226633548260084047
2024-01-28 19:03:24.313 UTC,"postgres","postgres",148,"10.42.2.6:47834",65b6a4fc.94,3,"authentication",2024-01-28 19:03:24 UTC,6/113,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,8226633548260084047
2024-01-28 19:03:24.315 UTC,"postgres","postgres",148,"10.42.2.6:47834",65b6a4fc.94,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47834",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.317 UTC,,,149,"10.42.2.6:47848",65b6a4fc.95,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47848",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.320 UTC,"postgres","postgres",149,"10.42.2.6:47848",65b6a4fc.95,2,"authentication",2024-01-28 19:03:24 UTC,6/115,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,8226633548260084047
2024-01-28 19:03:24.320 UTC,"postgres","postgres",149,"10.42.2.6:47848",65b6a4fc.95,3,"authentication",2024-01-28 19:03:24 UTC,6/115,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,8226633548260084047
2024-01-28 19:03:24.321 UTC,"postgres","postgres",149,"10.42.2.6:47848",65b6a4fc.95,4,"idle",2024-01-28 19:03:24 UTC,6/116,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_writer"" NOLOGIN IN ROLE ""bar_reader"" ADMIN bar_owner ENCRYPTED PASSWORD 'md58343a94cfc313b15396dafbc0e6f74e3';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.321 UTC,"postgres","postgres",149,"10.42.2.6:47848",65b6a4fc.95,5,"CREATE ROLE",2024-01-28 19:03:24 UTC,6/116,929,ERROR,42704,"role ""bar_reader"" does not exist",,,,,,"SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_writer"" NOLOGIN IN ROLE ""bar_reader"" ADMIN bar_owner ENCRYPTED PASSWORD 'md58343a94cfc313b15396dafbc0e6f74e3';",,,"","client backend",,8601456888649285005
2024-01-28 19:03:24.322 UTC,"postgres","postgres",149,"10.42.2.6:47848",65b6a4fc.95,6,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=10.42.2.6 port=47848",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.323 UTC,,,150,"10.42.2.6:47854",65b6a4fc.96,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47854",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.326 UTC,"postgres","postgres",150,"10.42.2.6:47854",65b6a4fc.96,2,"authentication",2024-01-28 19:03:24 UTC,6/117,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,8601456888649285005
2024-01-28 19:03:24.326 UTC,"postgres","postgres",150,"10.42.2.6:47854",65b6a4fc.96,3,"authentication",2024-01-28 19:03:24 UTC,6/117,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,8601456888649285005
2024-01-28 19:03:24.328 UTC,"postgres","postgres",150,"10.42.2.6:47854",65b6a4fc.96,4,"DO",2024-01-28 19:03:24 UTC,6/118,0,ERROR,42704,"role ""bar_writer"" does not exist",,,,,"SQL statement ""ALTER ROLE ""bar_writer"" RESET ALL""
PL/pgSQL function inline_code_block line 1 at SQL statement","SET LOCAL synchronous_commit = 'local'; DO $$ BEGIN ALTER ROLE ""bar_writer"" RESET ALL;ALTER ROLE ""bar_writer"" SET search_path TO ""$user"", data; END;$$;",,,"","client backend",,4880314096566011489
2024-01-28 19:03:24.328 UTC,"postgres","postgres",150,"10.42.2.6:47854",65b6a4fc.96,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47854",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.330 UTC,,,151,"10.42.2.6:47864",65b6a4fc.97,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47864",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.332 UTC,"postgres","postgres",151,"10.42.2.6:47864",65b6a4fc.97,2,"authentication",2024-01-28 19:03:24 UTC,6/119,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,4880314096566011489
2024-01-28 19:03:24.332 UTC,"postgres","postgres",151,"10.42.2.6:47864",65b6a4fc.97,3,"authentication",2024-01-28 19:03:24 UTC,6/119,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,4880314096566011489
2024-01-28 19:03:24.334 UTC,"postgres","postgres",151,"10.42.2.6:47864",65b6a4fc.97,4,"idle",2024-01-28 19:03:24 UTC,6/120,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_data_owner"" NOLOGIN ADMIN bar_owner ENCRYPTED PASSWORD 'md50c8a70802047a93478f610714aa58b33';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.335 UTC,"postgres","postgres",151,"10.42.2.6:47864",65b6a4fc.97,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47864",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.336 UTC,,,152,"10.42.2.6:47878",65b6a4fc.98,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47878",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.339 UTC,"postgres","postgres",152,"10.42.2.6:47878",65b6a4fc.98,2,"authentication",2024-01-28 19:03:24 UTC,6/121,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,6554794793818797335
2024-01-28 19:03:24.339 UTC,"postgres","postgres",152,"10.42.2.6:47878",65b6a4fc.98,3,"authentication",2024-01-28 19:03:24 UTC,6/121,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,6554794793818797335
2024-01-28 19:03:24.341 UTC,"postgres","postgres",152,"10.42.2.6:47878",65b6a4fc.98,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47878",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.344 UTC,,,153,"10.42.2.6:47880",65b6a4fc.99,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47880",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.347 UTC,"postgres","postgres",153,"10.42.2.6:47880",65b6a4fc.99,2,"authentication",2024-01-28 19:03:24 UTC,6/123,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-2022045433304352858
2024-01-28 19:03:24.347 UTC,"postgres","postgres",153,"10.42.2.6:47880",65b6a4fc.99,3,"authentication",2024-01-28 19:03:24 UTC,6/123,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-2022045433304352858
2024-01-28 19:03:24.349 UTC,"postgres","postgres",153,"10.42.2.6:47880",65b6a4fc.99,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47880",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.350 UTC,,,154,"10.42.2.6:47892",65b6a4fc.9a,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47892",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.353 UTC,"postgres","postgres",154,"10.42.2.6:47892",65b6a4fc.9a,2,"authentication",2024-01-28 19:03:24 UTC,6/125,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-2022045433304352858
2024-01-28 19:03:24.353 UTC,"postgres","postgres",154,"10.42.2.6:47892",65b6a4fc.9a,3,"authentication",2024-01-28 19:03:24 UTC,6/125,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-2022045433304352858
2024-01-28 19:03:24.354 UTC,"postgres","postgres",154,"10.42.2.6:47892",65b6a4fc.9a,4,"idle",2024-01-28 19:03:24 UTC,6/126,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_data_reader"" NOLOGIN ADMIN bar_data_owner ENCRYPTED PASSWORD 'md5be4a60cf8c18cddcc03f68cca2d6d013';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.355 UTC,"postgres","postgres",154,"10.42.2.6:47892",65b6a4fc.9a,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=10.42.2.6 port=47892",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.357 UTC,,,155,"10.42.2.6:47904",65b6a4fc.9b,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47904",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.360 UTC,"postgres","postgres",155,"10.42.2.6:47904",65b6a4fc.9b,2,"authentication",2024-01-28 19:03:24 UTC,6/127,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-2228019661764623557
2024-01-28 19:03:24.360 UTC,"postgres","postgres",155,"10.42.2.6:47904",65b6a4fc.9b,3,"authentication",2024-01-28 19:03:24 UTC,6/127,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-2228019661764623557
2024-01-28 19:03:24.363 UTC,"postgres","postgres",155,"10.42.2.6:47904",65b6a4fc.9b,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47904",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.364 UTC,,,156,"10.42.2.6:47920",65b6a4fc.9c,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47920",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.367 UTC,"postgres","postgres",156,"10.42.2.6:47920",65b6a4fc.9c,2,"authentication",2024-01-28 19:03:24 UTC,6/129,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,1207753786936752352
2024-01-28 19:03:24.367 UTC,"postgres","postgres",156,"10.42.2.6:47920",65b6a4fc.9c,3,"authentication",2024-01-28 19:03:24 UTC,6/129,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,1207753786936752352
2024-01-28 19:03:24.369 UTC,"postgres","postgres",156,"10.42.2.6:47920",65b6a4fc.9c,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47920",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.371 UTC,,,157,"10.42.2.6:47932",65b6a4fc.9d,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47932",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.374 UTC,"postgres","postgres",157,"10.42.2.6:47932",65b6a4fc.9d,2,"authentication",2024-01-28 19:03:24 UTC,6/131,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,1207753786936752352
2024-01-28 19:03:24.374 UTC,"postgres","postgres",157,"10.42.2.6:47932",65b6a4fc.9d,3,"authentication",2024-01-28 19:03:24 UTC,6/131,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,1207753786936752352
2024-01-28 19:03:24.375 UTC,"postgres","postgres",157,"10.42.2.6:47932",65b6a4fc.9d,4,"idle",2024-01-28 19:03:24 UTC,6/132,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""zalando"" CREATEDB LOGIN SUPERUSER ADMIN admin ENCRYPTED PASSWORD 'md50877f3914ef370d2d7949e7439ce5cea';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.375 UTC,"postgres","postgres",157,"10.42.2.6:47932",65b6a4fc.9d,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=10.42.2.6 port=47932",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.377 UTC,,,158,"10.42.2.6:47936",65b6a4fc.9e,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47936",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.380 UTC,"postgres","postgres",158,"10.42.2.6:47936",65b6a4fc.9e,2,"authentication",2024-01-28 19:03:24 UTC,6/133,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-2163700376311349640
2024-01-28 19:03:24.380 UTC,"postgres","postgres",158,"10.42.2.6:47936",65b6a4fc.9e,3,"authentication",2024-01-28 19:03:24 UTC,6/133,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-2163700376311349640
2024-01-28 19:03:24.381 UTC,"postgres","postgres",158,"10.42.2.6:47936",65b6a4fc.9e,4,"idle",2024-01-28 19:03:24 UTC,6/134,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_data_writer"" NOLOGIN IN ROLE ""bar_data_reader"" ADMIN bar_data_owner ENCRYPTED PASSWORD 'md54b36174c3c13316a50f86fdd952df56a';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.382 UTC,"postgres","postgres",158,"10.42.2.6:47936",65b6a4fc.9e,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47936",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.383 UTC,,,159,"10.42.2.6:47938",65b6a4fc.9f,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47938",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.386 UTC,"postgres","postgres",159,"10.42.2.6:47938",65b6a4fc.9f,2,"authentication",2024-01-28 19:03:24 UTC,6/135,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-8056320529860082986
2024-01-28 19:03:24.386 UTC,"postgres","postgres",159,"10.42.2.6:47938",65b6a4fc.9f,3,"authentication",2024-01-28 19:03:24 UTC,6/135,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-8056320529860082986
2024-01-28 19:03:24.389 UTC,"postgres","postgres",159,"10.42.2.6:47938",65b6a4fc.9f,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47938",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.390 UTC,,,160,"10.42.2.6:47948",65b6a4fc.a0,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47948",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.393 UTC,"postgres","postgres",160,"10.42.2.6:47948",65b6a4fc.a0,2,"authentication",2024-01-28 19:03:24 UTC,6/137,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-8438975612547845671
2024-01-28 19:03:24.393 UTC,"postgres","postgres",160,"10.42.2.6:47948",65b6a4fc.a0,3,"authentication",2024-01-28 19:03:24 UTC,6/137,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-8438975612547845671
2024-01-28 19:03:24.395 UTC,"postgres","postgres",160,"10.42.2.6:47948",65b6a4fc.a0,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47948",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.397 UTC,,,161,"10.42.2.6:47956",65b6a4fc.a1,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47956",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.400 UTC,"postgres","postgres",161,"10.42.2.6:47956",65b6a4fc.a1,2,"authentication",2024-01-28 19:03:24 UTC,6/139,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-8438975612547845671
2024-01-28 19:03:24.400 UTC,"postgres","postgres",161,"10.42.2.6:47956",65b6a4fc.a1,3,"authentication",2024-01-28 19:03:24 UTC,6/139,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-8438975612547845671
2024-01-28 19:03:24.401 UTC,"postgres","postgres",161,"10.42.2.6:47956",65b6a4fc.a1,4,"idle",2024-01-28 19:03:24 UTC,6/140,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""foo_user"" LOGIN ADMIN admin ENCRYPTED PASSWORD 'md535d1704e900576b967cbd16a0e1e7e9b';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.402 UTC,"postgres","postgres",161,"10.42.2.6:47956",65b6a4fc.a1,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=10.42.2.6 port=47956",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.403 UTC,,,162,"10.42.2.6:47964",65b6a4fc.a2,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47964",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.406 UTC,"postgres","postgres",162,"10.42.2.6:47964",65b6a4fc.a2,2,"authentication",2024-01-28 19:03:24 UTC,6/141,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-8156370801428223570
2024-01-28 19:03:24.406 UTC,"postgres","postgres",162,"10.42.2.6:47964",65b6a4fc.a2,3,"authentication",2024-01-28 19:03:24 UTC,6/141,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-8156370801428223570
2024-01-28 19:03:24.407 UTC,"postgres","postgres",162,"10.42.2.6:47964",65b6a4fc.a2,4,"idle",2024-01-28 19:03:24 UTC,6/142,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_reader"" NOLOGIN ADMIN bar_owner ENCRYPTED PASSWORD 'md5f5e2666de51d09ee4395cb89b51f9d9a';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.408 UTC,"postgres","postgres",162,"10.42.2.6:47964",65b6a4fc.a2,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=10.42.2.6 port=47964",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.409 UTC,,,163,"10.42.2.6:47972",65b6a4fc.a3,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47972",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.413 UTC,"postgres","postgres",163,"10.42.2.6:47972",65b6a4fc.a3,2,"authentication",2024-01-28 19:03:24 UTC,6/143,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,8028541353018152716
2024-01-28 19:03:24.413 UTC,"postgres","postgres",163,"10.42.2.6:47972",65b6a4fc.a3,3,"authentication",2024-01-28 19:03:24 UTC,6/143,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,8028541353018152716
2024-01-28 19:03:24.415 UTC,"postgres","postgres",163,"10.42.2.6:47972",65b6a4fc.a3,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=47972",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.417 UTC,,,164,"10.42.2.6:47988",65b6a4fc.a4,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=47988",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.421 UTC,"postgres","postgres",164,"10.42.2.6:47988",65b6a4fc.a4,2,"authentication",2024-01-28 19:03:24 UTC,6/145,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,5168183762432867628
2024-01-28 19:03:24.421 UTC,"postgres","postgres",164,"10.42.2.6:47988",65b6a4fc.a4,3,"authentication",2024-01-28 19:03:24 UTC,6/145,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,5168183762432867628
2024-01-28 19:03:24.424 UTC,"postgres","postgres",164,"10.42.2.6:47988",65b6a4fc.a4,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.006 user=postgres database=postgres host=10.42.2.6 port=47988",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.426 UTC,,,165,"10.42.2.6:48002",65b6a4fc.a5,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48002",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.429 UTC,"postgres","postgres",165,"10.42.2.6:48002",65b6a4fc.a5,2,"authentication",2024-01-28 19:03:24 UTC,6/147,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,5168183762432867628
2024-01-28 19:03:24.429 UTC,"postgres","postgres",165,"10.42.2.6:48002",65b6a4fc.a5,3,"authentication",2024-01-28 19:03:24 UTC,6/147,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,5168183762432867628
2024-01-28 19:03:24.430 UTC,"postgres","postgres",165,"10.42.2.6:48002",65b6a4fc.a5,4,"idle",2024-01-28 19:03:24 UTC,6/148,0,LOG,00000,"statement: SET LOCAL synchronous_commit = 'local'; CREATE ROLE ""bar_writer"" NOLOGIN IN ROLE ""bar_reader"" ADMIN bar_owner ENCRYPTED PASSWORD 'md58343a94cfc313b15396dafbc0e6f74e3';",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.431 UTC,"postgres","postgres",165,"10.42.2.6:48002",65b6a4fc.a5,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=10.42.2.6 port=48002",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.433 UTC,,,166,"10.42.2.6:48004",65b6a4fc.a6,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48004",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.436 UTC,"postgres","postgres",166,"10.42.2.6:48004",65b6a4fc.a6,2,"authentication",2024-01-28 19:03:24 UTC,6/149,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,8601456888649285005
2024-01-28 19:03:24.436 UTC,"postgres","postgres",166,"10.42.2.6:48004",65b6a4fc.a6,3,"authentication",2024-01-28 19:03:24 UTC,6/149,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,8601456888649285005
2024-01-28 19:03:24.438 UTC,"postgres","postgres",166,"10.42.2.6:48004",65b6a4fc.a6,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=48004",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.440 UTC,,,167,"10.42.2.6:48016",65b6a4fc.a7,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48016",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.443 UTC,"postgres","postgres",167,"10.42.2.6:48016",65b6a4fc.a7,2,"authentication",2024-01-28 19:03:24 UTC,6/151,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,4880314096566011489
2024-01-28 19:03:24.443 UTC,"postgres","postgres",167,"10.42.2.6:48016",65b6a4fc.a7,3,"authentication",2024-01-28 19:03:24 UTC,6/151,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,4880314096566011489
2024-01-28 19:03:24.446 UTC,"postgres","postgres",167,"10.42.2.6:48016",65b6a4fc.a7,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=48016",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.448 UTC,,,168,"10.42.2.6:48032",65b6a4fc.a8,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48032",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.451 UTC,"postgres","postgres",168,"10.42.2.6:48032",65b6a4fc.a8,2,"authentication",2024-01-28 19:03:24 UTC,6/153,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,4880314096566011489
2024-01-28 19:03:24.451 UTC,"postgres","postgres",168,"10.42.2.6:48032",65b6a4fc.a8,3,"authentication",2024-01-28 19:03:24 UTC,6/153,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,4880314096566011489
2024-01-28 19:03:24.452 UTC,"postgres","postgres",168,"10.42.2.6:48032",65b6a4fc.a8,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=postgres host=10.42.2.6 port=48032",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.453 UTC,,,169,"10.42.2.6:48048",65b6a4fc.a9,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48048",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.456 UTC,"postgres","postgres",169,"10.42.2.6:48048",65b6a4fc.a9,2,"authentication",2024-01-28 19:03:24 UTC,6/155,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.456 UTC,"postgres","postgres",169,"10.42.2.6:48048",65b6a4fc.a9,3,"authentication",2024-01-28 19:03:24 UTC,6/155,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.458 UTC,"postgres","postgres",169,"10.42.2.6:48048",65b6a4fc.a9,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=postgres host=10.42.2.6 port=48048",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.460 UTC,,,170,"10.42.2.6:48064",65b6a4fc.aa,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48064",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.463 UTC,"postgres","postgres",170,"10.42.2.6:48064",65b6a4fc.aa,2,"authentication",2024-01-28 19:03:24 UTC,6/157,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,1717504786121777440
2024-01-28 19:03:24.463 UTC,"postgres","postgres",170,"10.42.2.6:48064",65b6a4fc.aa,3,"authentication",2024-01-28 19:03:24 UTC,6/157,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,1717504786121777440
2024-01-28 19:03:24.464 UTC,"postgres","postgres",170,"10.42.2.6:48064",65b6a4fc.aa,4,"idle",2024-01-28 19:03:24 UTC,6/158,0,LOG,00000,"statement: CREATE DATABASE ""bar"" OWNER ""bar_owner"";",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.465 UTC,,,77,,65b6a4fa.4d,1,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint starting: immediate force wait flush-all",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.534 UTC,,,77,,65b6a4fa.4d,2,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint complete: wrote 407 buffers (3.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.054 s, sync=0.013 s, total=0.069 s; sync files=174, longest=0.001 s, average=0.001 s; distance=1283 kB, estimate=1283 kB",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.751 UTC,,,77,,65b6a4fa.4d,3,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint starting: immediate force wait",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.755 UTC,,,77,,65b6a4fa.4d,4,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint complete: wrote 0 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.001 s, sync=0.001 s, total=0.005 s; sync files=0, longest=0.000 s, average=0.000 s; distance=0 kB, estimate=1154 kB",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.757 UTC,"postgres","postgres",170,"10.42.2.6:48064",65b6a4fc.aa,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.296 user=postgres database=postgres host=10.42.2.6 port=48064",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.758 UTC,,,171,"10.42.2.6:48078",65b6a4fc.ab,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48078",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:24.762 UTC,"postgres","postgres",171,"10.42.2.6:48078",65b6a4fc.ab,2,"authentication",2024-01-28 19:03:24 UTC,6/159,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,5731473871814070528
2024-01-28 19:03:24.762 UTC,"postgres","postgres",171,"10.42.2.6:48078",65b6a4fc.ab,3,"authentication",2024-01-28 19:03:24 UTC,6/159,0,LOG,00000,"connection authorized: user=postgres database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,5731473871814070528
2024-01-28 19:03:24.763 UTC,"postgres","postgres",171,"10.42.2.6:48078",65b6a4fc.ab,4,"idle",2024-01-28 19:03:24 UTC,6/160,0,LOG,00000,"statement: CREATE DATABASE ""foo"" OWNER ""zalando"";",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.764 UTC,,,77,,65b6a4fa.4d,5,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint starting: immediate force wait flush-all",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.770 UTC,,,77,,65b6a4fa.4d,6,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint complete: wrote 12 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.003 s, sync=0.001 s, total=0.006 s; sync files=9, longest=0.001 s, average=0.001 s; distance=11 kB, estimate=1040 kB",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.989 UTC,,,77,,65b6a4fa.4d,7,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint starting: immediate force wait",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.995 UTC,,,77,,65b6a4fa.4d,8,,2024-01-28 19:03:22 UTC,,0,LOG,00000,"checkpoint complete: wrote 0 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.002 s, sync=0.001 s, total=0.007 s; sync files=0, longest=0.000 s, average=0.000 s; distance=0 kB, estimate=936 kB",,,,,,,,,"","checkpointer",,0
2024-01-28 19:03:24.996 UTC,"postgres","postgres",171,"10.42.2.6:48078",65b6a4fc.ab,5,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.238 user=postgres database=postgres host=10.42.2.6 port=48078",,,,,,,,,"","client backend",,0
2024-01-28 19:03:24.999 UTC,,,172,"10.42.2.6:48084",65b6a4fc.ac,1,"",2024-01-28 19:03:24 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48084",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.002 UTC,"postgres","bar",172,"10.42.2.6:48084",65b6a4fc.ac,2,"authentication",2024-01-28 19:03:24 UTC,6/161,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,8965492035905852316
2024-01-28 19:03:25.002 UTC,"postgres","bar",172,"10.42.2.6:48084",65b6a4fc.ac,3,"authentication",2024-01-28 19:03:24 UTC,6/161,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,8965492035905852316
2024-01-28 19:03:25.006 UTC,"postgres","bar",172,"10.42.2.6:48084",65b6a4fc.ac,4,"idle",2024-01-28 19:03:24 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.007 user=postgres database=bar host=10.42.2.6 port=48084",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.011 UTC,,,173,"10.42.2.6:48094",65b6a4fd.ad,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48094",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.014 UTC,"postgres","bar",173,"10.42.2.6:48094",65b6a4fd.ad,2,"authentication",2024-01-28 19:03:25 UTC,6/163,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.014 UTC,"postgres","bar",173,"10.42.2.6:48094",65b6a4fd.ad,3,"authentication",2024-01-28 19:03:25 UTC,6/163,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.015 UTC,"postgres","bar",173,"10.42.2.6:48094",65b6a4fd.ad,4,"idle",2024-01-28 19:03:25 UTC,6/164,0,LOG,00000,"statement: SET ROLE TO ""bar_owner"";
			ALTER DEFAULT PRIVILEGES GRANT USAGE ON SCHEMAS TO ""bar_writer"",""bar_reader"";
			ALTER DEFAULT PRIVILEGES GRANT SELECT ON TABLES TO ""bar_reader"";
			ALTER DEFAULT PRIVILEGES GRANT SELECT ON SEQUENCES TO ""bar_reader"";
			ALTER DEFAULT PRIVILEGES GRANT INSERT, UPDATE, DELETE ON TABLES TO ""bar_writer"";
			ALTER DEFAULT PRIVILEGES GRANT USAGE, UPDATE ON SEQUENCES TO ""bar_writer"";
			ALTER DEFAULT PRIVILEGES GRANT EXECUTE ON FUNCTIONS TO ""bar_reader"",""bar_writer"";
			ALTER DEFAULT PRIVILEGES GRANT USAGE ON TYPES TO ""bar_reader"",""bar_writer"";",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.019 UTC,"postgres","bar",173,"10.42.2.6:48094",65b6a4fd.ad,5,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.008 user=postgres database=bar host=10.42.2.6 port=48094",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.021 UTC,,,174,"10.42.2.6:48096",65b6a4fd.ae,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48096",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.024 UTC,"postgres","bar",174,"10.42.2.6:48096",65b6a4fd.ae,2,"authentication",2024-01-28 19:03:25 UTC,6/165,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-8989314904100542473
2024-01-28 19:03:25.024 UTC,"postgres","bar",174,"10.42.2.6:48096",65b6a4fd.ae,3,"authentication",2024-01-28 19:03:25 UTC,6/165,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-8989314904100542473
2024-01-28 19:03:25.025 UTC,"postgres","bar",174,"10.42.2.6:48096",65b6a4fd.ae,4,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=bar host=10.42.2.6 port=48096",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.027 UTC,,,175,"10.42.2.6:48110",65b6a4fd.af,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48110",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.030 UTC,"postgres","bar",175,"10.42.2.6:48110",65b6a4fd.af,2,"authentication",2024-01-28 19:03:25 UTC,6/167,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.030 UTC,"postgres","bar",175,"10.42.2.6:48110",65b6a4fd.af,3,"authentication",2024-01-28 19:03:25 UTC,6/167,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.037 UTC,"postgres","bar",175,"10.42.2.6:48110",65b6a4fd.af,4,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.009 user=postgres database=bar host=10.42.2.6 port=48110",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.039 UTC,,,176,"10.42.2.6:48126",65b6a4fd.b0,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48126",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.041 UTC,"postgres","bar",176,"10.42.2.6:48126",65b6a4fd.b0,2,"authentication",2024-01-28 19:03:25 UTC,6/169,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-6396947832378194637
2024-01-28 19:03:25.041 UTC,"postgres","bar",176,"10.42.2.6:48126",65b6a4fd.b0,3,"authentication",2024-01-28 19:03:25 UTC,6/169,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-6396947832378194637
2024-01-28 19:03:25.042 UTC,"postgres","bar",176,"10.42.2.6:48126",65b6a4fd.b0,4,"idle",2024-01-28 19:03:25 UTC,6/170,0,LOG,00000,"statement: SET ROLE TO ""bar_owner""; CREATE SCHEMA IF NOT EXISTS ""data"" AUTHORIZATION ""bar_data_owner""",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.043 UTC,"postgres","bar",176,"10.42.2.6:48126",65b6a4fd.b0,5,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.004 user=postgres database=bar host=10.42.2.6 port=48126",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.045 UTC,,,177,"10.42.2.6:48132",65b6a4fd.b1,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48132",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.048 UTC,"postgres","bar",177,"10.42.2.6:48132",65b6a4fd.b1,2,"authentication",2024-01-28 19:03:25 UTC,6/171,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,6293526577520568508
2024-01-28 19:03:25.048 UTC,"postgres","bar",177,"10.42.2.6:48132",65b6a4fd.b1,3,"authentication",2024-01-28 19:03:25 UTC,6/171,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,6293526577520568508
2024-01-28 19:03:25.049 UTC,"postgres","bar",177,"10.42.2.6:48132",65b6a4fd.b1,4,"idle",2024-01-28 19:03:25 UTC,6/172,0,LOG,00000,"statement: SET ROLE TO ""bar_data_owner"";
			GRANT USAGE ON SCHEMA ""data"" TO ""bar_reader"",""bar_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT SELECT ON TABLES TO ""bar_reader"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT SELECT ON SEQUENCES TO ""bar_reader"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT INSERT, UPDATE, DELETE ON TABLES TO ""bar_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT USAGE, UPDATE ON SEQUENCES TO ""bar_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT EXECUTE ON FUNCTIONS TO ""bar_reader"",""bar_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT USAGE ON TYPES TO ""bar_reader"",""bar_writer"";",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.052 UTC,"postgres","bar",177,"10.42.2.6:48132",65b6a4fd.b1,5,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.006 user=postgres database=bar host=10.42.2.6 port=48132",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.053 UTC,,,178,"10.42.2.6:48136",65b6a4fd.b2,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48136",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.056 UTC,"postgres","bar",178,"10.42.2.6:48136",65b6a4fd.b2,2,"authentication",2024-01-28 19:03:25 UTC,6/173,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-8915789285541906276
2024-01-28 19:03:25.056 UTC,"postgres","bar",178,"10.42.2.6:48136",65b6a4fd.b2,3,"authentication",2024-01-28 19:03:25 UTC,6/173,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-8915789285541906276
2024-01-28 19:03:25.058 UTC,"postgres","bar",178,"10.42.2.6:48136",65b6a4fd.b2,4,"idle",2024-01-28 19:03:25 UTC,6/174,0,LOG,00000,"statement: SET ROLE TO ""bar_owner"";
			GRANT USAGE ON SCHEMA ""data"" TO ""bar_data_reader"",""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT SELECT ON TABLES TO ""bar_data_reader"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT SELECT ON SEQUENCES TO ""bar_data_reader"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT INSERT, UPDATE, DELETE ON TABLES TO ""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT USAGE, UPDATE ON SEQUENCES TO ""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT EXECUTE ON FUNCTIONS TO ""bar_data_reader"",""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT USAGE ON TYPES TO ""bar_data_reader"",""bar_data_writer"";",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.059 UTC,"postgres","bar",178,"10.42.2.6:48136",65b6a4fd.b2,5,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.006 user=postgres database=bar host=10.42.2.6 port=48136",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.061 UTC,,,179,"10.42.2.6:48152",65b6a4fd.b3,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48152",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.064 UTC,"postgres","bar",179,"10.42.2.6:48152",65b6a4fd.b3,2,"authentication",2024-01-28 19:03:25 UTC,6/175,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-3783113529100653339
2024-01-28 19:03:25.064 UTC,"postgres","bar",179,"10.42.2.6:48152",65b6a4fd.b3,3,"authentication",2024-01-28 19:03:25 UTC,6/175,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-3783113529100653339
2024-01-28 19:03:25.065 UTC,"postgres","bar",179,"10.42.2.6:48152",65b6a4fd.b3,4,"idle",2024-01-28 19:03:25 UTC,6/176,0,LOG,00000,"statement: SET ROLE TO ""bar_data_owner"";
			GRANT USAGE ON SCHEMA ""data"" TO ""bar_data_reader"",""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT SELECT ON TABLES TO ""bar_data_reader"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT SELECT ON SEQUENCES TO ""bar_data_reader"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT INSERT, UPDATE, DELETE ON TABLES TO ""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT USAGE, UPDATE ON SEQUENCES TO ""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT EXECUTE ON FUNCTIONS TO ""bar_data_reader"",""bar_data_writer"";
			ALTER DEFAULT PRIVILEGES IN SCHEMA ""data"" GRANT USAGE ON TYPES TO ""bar_data_reader"",""bar_data_writer"";",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.066 UTC,"postgres","bar",179,"10.42.2.6:48152",65b6a4fd.b3,5,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.005 user=postgres database=bar host=10.42.2.6 port=48152",,,,,,,,,"","client backend",,0
2024-01-28 19:03:25.068 UTC,,,180,"10.42.2.6:48164",65b6a4fd.b4,1,"",2024-01-28 19:03:25 UTC,,0,LOG,00000,"connection received: host=10.42.2.6 port=48164",,,,,,,,,"","not initialized",,0
2024-01-28 19:03:25.071 UTC,"postgres","bar",180,"10.42.2.6:48164",65b6a4fd.b4,2,"authentication",2024-01-28 19:03:25 UTC,6/177,0,LOG,00000,"connection authenticated: identity=""postgres"" method=md5 (/home/postgres/pgdata/pgroot/data/pg_hba.conf:12)",,,,,,,,,"","client backend",,-3783113529100653339
2024-01-28 19:03:25.071 UTC,"postgres","bar",180,"10.42.2.6:48164",65b6a4fd.b4,3,"authentication",2024-01-28 19:03:25 UTC,6/177,0,LOG,00000,"connection authorized: user=postgres database=bar SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",,,,,,,,,"","client backend",,-3783113529100653339
2024-01-28 19:03:25.075 UTC,"postgres","bar",180,"10.42.2.6:48164",65b6a4fd.b4,4,"idle",2024-01-28 19:03:25 UTC,,0,LOG,00000,"disconnection: session time: 0:00:00.007 user=postgres database=bar host=10.42.2.6 port=48164",,,,,,,,,"","client backend",,0
